# 字幕翻译问题现状

> 本文档记录字幕翻译功能当前存在的问题，供后续优化参考。

---

## 测试样本

- **视频**: AWS re:Invent 2025 - Keynote with Dr. Werner Vogels
- **video_id**: 3Y1G9najGiI
- **英文原始字幕**: 829 条
- **中文翻译字幕**: 495 条（合并比例 1.7:1）

---

## 问题一：翻译内容丢失

### 现状
在 `00:37:54 ~ 00:40:04` 区间，英文原始字幕有 **27条** 内容，但中文翻译完全丢失，形成约 **129.8秒（2分10秒）** 的空白间隙。

### 丢失内容摘要
- "文艺复兴开发者"的第三个特质：沟通能力
- The Frugal Architect（节俭架构师）案例讲解
- 亚马逊系统三层架构分层说明

### 相关时间戳
| 位置 | 中文字幕最后一条 | 中文字幕下一条 | 间隙 |
|------|-----------------|---------------|------|
| 38分钟附近 | 00:37:54.438 | 00:40:04.235 | 129.8秒 |

---

## 问题二：多处时间间隙异常

### 现状
中文翻译字幕存在多处超过30秒的时间间隙：

| 间隙开始 | 间隙结束 | 持续时间 |
|----------|----------|----------|
| 00:00:15.949 | 00:01:18.044 | 62.1秒 |
| 00:02:05.391 | 00:02:37.223 | 31.8秒 |
| 00:10:18.017 | 00:12:32.218 | 134.2秒 |
| 00:29:28.399 | 00:30:59.858 | 91.5秒 |
| **00:37:54.438** | **00:40:04.235** | **129.8秒** ⚠️ |
| 00:55:57.147 | 00:57:06.489 | 69.3秒 |
| 01:00:09.706 | 01:02:47.497 | 157.8秒 |
| 01:14:12.748 | 01:14:48.150 | 35.4秒 |

> 注：部分间隙可能是视频本身无对话（如播放视频片段、鼓掌等），但需与英文原始字幕对照确认哪些是异常丢失。

---

## 问题三：时间戳匹配率

### 当前质量报告
```
精确匹配:         490 条 (99.0%)
500ms内偏移:      1 条
2秒内偏移:        3 条
无法匹配:         1 条 (00:35:50.641)
----------------------------------------
质量评分:         99.5/100
评级:             优秀 ⭐⭐⭐
```

### 历史问题（已部分解决）
- 大模型翻译时会修改时间戳的毫秒部分
- 例：`00:38:30.174` → `00:38:30.261`
- 已在提示词中添加"禁止创造新时间戳"规则

---

## 相关文件

| 文件类型 | 路径 |
|----------|------|
| 英文原始字幕 | `downloads/subtitles/AWS reInvent 2025 - Keynote with Dr. Werner Vogels.en.vtt` |
| 中文翻译字幕 | `downloads/subtitles/translated/3Y1G9najGiI.zh.vtt` |
| 翻译提示词 | `src/reinvent_insight/domain/prompts/subtitle.py` |
| 翻译服务 | `src/reinvent_insight/services/subtitle_translation_service.py` |

---

*记录时间: 2025-12-13*
