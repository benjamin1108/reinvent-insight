# -*- coding: utf-8 -*-
"""
文章校对提示词模板 - 智能分步处理

采用智能策略：
0. STEP0: 评估是否需要结构重组
1. STEP1: 如需重组，输出映射规划表
2. STEP2: 分板块整合或仅润色衔接
"""

# Step 0: 评估是否需要结构重组
STEP0_EVALUATE_PROMPT = """
## 任务
评估这篇文章是否需要结构重组，还是仅需优化衔接和流畅度。

## 章节列表 ({chapter_count} 章)
{chapter_list}

## 原始素材（参考）
{original_content}

## 评估标准
如果存在以下问题，则需要重组：
1. **主题重复**：多个章节讨论相同的案例或观点
2. **主题散落**：同一主题被拆分到不相邻的章节
3. **过度碎片化**：本应是子标题的内容被提升为一级标题

如果以上问题都不存在，则仅需优化衔接和流畅度。

## 输出格式（严格遵守）
请只输出一行：
- 如果需要重组：`需要重组: [原因]`
- 如果不需要：`仅需优化: 章节结构合理，无重复散落`
"""

# Step 1: 映射规划（不强制章节数量）
STEP1_MAPPING_PROMPT = """
## 任务
你是一位技术编辑，需要将 {chapter_count} 个碎片化章节重组为逻辑连贯的核心板块。

## 原始章节列表
{chapter_list}

## 原始素材（参考）
{original_content}

## 重组原则
1. **合并同类**：相同主题的章节应合并到一个板块
2. **逻辑递进**：板块顺序应有叙事流动性（理念 -> 实践 -> 案例 -> 总结）
3. **每个原章节只能归属一个新板块**
4. **板块数量由内容决定**：如果原有 20 章未重复，可保持 15-20 个板块；如果大量重复，可合并到 6-10 个

## 输出格式（严格遵守）
请严格按以下格式输出，每行一个板块：

```
板块1: [新板块标题] <- 原章节 1,2,5
板块2: [新板块标题] <- 原章节 3,4
板块3: [新板块标题] <- 原章节 6
...
```

## 要求
- 只输出映射表，不要输出其他内容
- 编号从 1 开始连续
- 原章节编号用逗号分隔
- 如果某章节不需合并，可单独一行（如 `板块3: [标题] <- 原章节 6`）
"""

# Step 2 (整合模式): 整合多个源章节为一个板块
STEP2_MERGE_PROMPT = """
## 任务
将以下多个源章节整合为一个逻辑连贯的板块。

## 新板块信息
- 编号：{section_idx}
- 标题：{section_title}

## 源章节内容
{source_content}

## 必须保留的金句
{quotes_to_keep}

## 必须保留的洞见
{insights_to_keep}

---

## 整合原则
1. **复用原文**：尽可能保留原文内容，不要重写或摘要化
2. **去除重复**：如果多个源章节有相同案例/观点，只保留最完整的一处
3. **平滑过渡**：在拼接处添加过渡句，消除拼接感
4. **保留特色**：金句（> “...”）、洞见（> **...**）必须完整保留
5. **子标题降级**：原章节标题降级为 ### 子标题

## 输出格式
直接输出 Markdown 内容，以 `## {section_idx}. {section_title}` 开头。

## 要求
- 只输出整合后的 Markdown 内容
- 不要输出任何解释或元信息
- 保持原文技术深度和细节
"""

# Step 2 (润色模式): 仅优化衔接，不重组结构
STEP2_POLISH_PROMPT = """
## 任务
这篇文章结构已经合理，无需重组。你只需优化章节之间的衔接和流畅度。

## 当前文章 ({chapter_count} 章)
{all_content}

## 原始素材（参考）
{original_content}

---

## 优化原则
1. **保持结构**：不要改变章节数量和顺序
2. **优化衔接**：在章节之间添加或优化过渡句
3. **保留特色**：金句、洞见、引言必须完整保留
4. **复用原文**：不要重写内容，只做微调

## 输出格式
直接输出优化后的完整文章（Markdown 格式）。

## 要求
- 只输出优化后的内容
- 不要输出任何解释
- 保持原有章节编号和标题
"""

# 保留旧的常量以保持兼容性
PROOFREADING_PROMPT_TEMPLATE = STEP1_MAPPING_PROMPT
SHOULD_PROOFREAD_PROMPT = ""
