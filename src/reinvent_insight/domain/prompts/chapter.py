# -*- coding: utf-8 -*-
"""
章节生成提示词模板
"""

# 章节深度约束模板（并发生成版）
CHAPTER_DEPTH_CONSTRAINT_TEMPLATE = """
## 当前章节的生成约束

根据大纲分析，该章节的特征如下：
- **原文内容量**: {source_content_amount}
- **信息密度**: {information_density}
- **建议生成深度**: {generation_depth}

## 内容范围与结构指导（防止重复的关键）

{rationale}

**基于上述指导，你必须严格遵守以下要求**：

1. **按子章节结构展开**：如果上方提供了子章节结构，请按顺序展开每个子章节，确保 key_points 中的论点都被覆盖
2. **遵循开篇指导**：如果提供了 opening_hook，请用该方式开篇，避免所有章节都以类似方式开始
3. **确保过渡完整**：如果提供了 closing_transition，结尾时要自然过渡到下一章的主题
4. **必须包含**：must_include 中列出的内容必须出现在正文中
5. **禁止涉及**：must_exclude 中列出的内容绝对不能出现，这些已在其他章节覆盖

**生成要求**：
1. **严格遵守深度建议**：
   - brief（简洁）：快速概括核心要点，不展开细节
     * 字数指导：2000 字
     * 适用场景：
       - Keynote：过渡性理念章节、简单功能更新、快速提及的客户案例
       - Deep Dive：背景介绍、前置知识、小节总结
       - 访谈：单个观点或短故事
   
   - moderate（适度）：适度展开关键论点和案例
     * 字数指导：3000 字
     * 适用场景：
       - Keynote：标准产品发布、方法论讲解、典型客户案例
       - Deep Dive：核心技术机制、架构设计、优化策略
       - 访谈：完整故事或深度观点讨论
   
   - detailed（详细）：深入分析并提供详细解读
     * 字数指导：5000 字
     * 适用场景：
       - Keynote：重大产品发布（CEO亲自发布）、核心战略理念、标杆客户案例
       - Deep Dive：复杂架构剖析、性能优化全流程、多层次技术决策
       - 访谈：创业历程、重大决策过程、行业深度洞察

2. **防止过度扩展**：
   - 如果原文内容稀少(sparse)，绝对不要为了凑字数而编造或过度推测
   - 如果原文只是简单提及某个点，你的解读也应该简短
   - 宁可生成较短但准确的内容，也不要生成冗长但偏离原文的内容

3. **基于原文事实**：
   - 所有论述必须有原文支撑
   - 不要添加原文中没有的案例、数据或观点
"""

# 步骤二：生成单个章节内容的提示词模板
CHAPTER_PROMPT_TEMPLATE = """
{role_and_style}

{base_prompt}

## 全局上下文
- **{content_type}**: {full_content}
- **完整大纲**: 
{full_outline}

{previous_chapters_context}

{chapter_depth_constraint}

---
## 当前任务
你的任务是为上述 **完整大纲** 中的**特定一章**撰写详细内容。

**当前章节**：第 `{chapter_number}` 章 - `{current_chapter_title}`

请基于**{content_description}**提供的上下文，并理解当前章节在**完整大纲**中的位置，为其撰写深入、详尽的内容。

## 风格与一致性要求
- **风格统一**: 写作风格、专业口吻和分析深度必须与报告其他部分保持高度一致，把自己想象成正在撰写一部完整作品
- **参考上下文**: 审视上方的**完整大纲**，理解当前章节的承上启下作用
- **术语一致**: 确保专业术语与**原内容**和**基础提示词**中定义的标准保持一致

## 内容去重要求
{deduplication_instruction}

## 章节内容结构
每章应包含以下三个方面的信息，但不要机械地分为三个独立标题，而应该是一个完整、流畅的段落：
- 章节摘要：全面、详细的概括
- 关键论点/数据/案例：精确引用数字与实例
- 深入解读：为什么重要、与现有认知的冲突或补充

## 写作前的强制检查清单

**在开始写作前，请确认你理解以下要点**：
1. ✅ 我将用纯中文写作，不在概念后加英文注释
2. ✅ 我将像《晚点LatePost》那样写作，专业但不学术化
3. ✅ 我将直接切入内容，不使用"上一章"、"演讲开场"等表达
4. ✅ 我将在写完后检查全文，删除所有"中文（英文）"格式

## 输出要求
- **只输出**第 `{chapter_number}` 章 **'{current_chapter_title}'** 的完整内容
- **格式关键**：输出必须以 `### {chapter_number}. {current_chapter_title}` (Markdown H3 标题) 开头
- **直接切入核心**：标题后直接用事实、数据、观点开始正文，禁止使用以下开场方式：
  - ❌ "上一章我们谈到..."、"接下来我们将..."
  - ❌ "演讲开场"、"演讲伊始"、"在最开始"、"开篇"
  - ❌ "从...说起"、"首先让我们..."
  - ✅ 直接陈述核心内容，如直接给出关键观点、数据或案例
- **纯中文表达**：全文使用纯中文，不要在任何概念后添加括号英文注释
- **内容灵活性**：根据章节内容的深度灵活调整，如果内容本身比较浅显，无需强行输出所有三个部分
- **小标题使用**：必要时可以灵活制定小标题帮助阅读理解，但避免使用机械的"章节摘要"、"关键论点/数据/案例"、"深入解读"这类标题
- **范围限制**：不需要包含引言、总结、其他章节或任何无关的文字

{quality_control_rules}

---
**请开始撰写第 `{chapter_number}` 章 - `{current_chapter_title}` 的内容。**
"""
