# -*- coding: utf-8 -*-
"""
提示词模板模块

说明：
- 基础提示词从 ./prompt/youtbe-deep-summary.txt 加载（在 workflow.py 中）
- 本模块定义特定任务的提示词模板和公共规则
"""

# PDF多模态分析指导
PDF_MULTIMODAL_GUIDE = ""

# 去重指令模板
DEDUPLICATION_INSTRUCTION_WITH_PREVIOUS = """- **避免冗余**: 仔细审查上方"上一章节的完整内容"，确保当前章节不与上一章节重复
- **差异化**: 如果某些概念在上一章节已经详细解释过，本章节只需简要提及或从不同角度展开
- **承接关系**: 可以适当引用上一章节的内容（如"如上一章所述..."），但不要重复展开相同的论述
- **边界清晰**: 严格按照大纲中当前章节的主题范围撰写，不要越界到其他章节的内容"""

DEDUPLICATION_INSTRUCTION_FIRST = """- 这是第一个章节，无需考虑与前序章节的重复问题"""

# 上一章节上下文模板
PREVIOUS_CHAPTER_CONTEXT_TEMPLATE = """
## 上一章节的完整内容（供参考，避免内容重复）
**第 {chapter_index} 章 - {chapter_title}**:

{chapter_content}
"""

# 质量控制规则（公共规则）
QUALITY_CONTROL_RULES = """
## 内容质量控制规则

### 1. 关键实体与术语一致性
- **专有名词统一**: 所有人名、公司名、产品名在全文中必须保持完全一致的拼写和大小写
- **术语标准化**: 首次出现的专业术语应附带英文原文或简要解释，后续使用保持一致
- **示例**: 
  - ✅ 正确：全文统一使用 "OpenAI"（不能出现 "Open AI" 或 "open AI"）
  - ✅ 正确：全文统一使用 "Sarah Friar"（不能出现 "Sarah Frier"）

### 2. 事实与细节准确性
- **官方全称**: 引用政府机构、公司、法案时必须使用官方完整名称
- **数据精确**: 所有数字、百分比、日期必须与原文完全一致
- **示例**:
  - ✅ 正确：Office of Science and Technology Policy（白宫科技政策办公室）
  - ❌ 错误：Office of Science and Technology（遗漏 Policy）

### 3. 引用内容转录准确性
- **逐字核对**: 所有英文原句引用必须与原文100%一致，不得有拼写错误、单词合并或重复
- **高优先级**: 将"金句"和"原声引用"视为最高优先级内容，必须逐字检查
- **示例**:
  - ✅ 正确：backstop
  - ❌ 错误：backs stop 或 the the backs stop

### 4. 排版与格式规范
**大小写规则**:
- 专有名词（OpenAI, Google, ChatGPT, GitHub）必须保持正确的大小写
- 句首字母大写，其他位置遵循专有名词规则

**标点符号规则**:
- 中文内容使用全角标点：，。？！：；
- 中文括号使用全角：（）
- 英文内容或专有名词使用半角标点：, . ? ! : ;
- 英文括号使用半角：()

**空格规则**:
- 中文与英文单词之间需要一个半角空格
- 中文与数字之间需要一个半角空格
- 数字与中文单位之间**严禁**空格：130亿美元、1.4万亿（不是 130 亿 美元）
- 英文单词之间保持一个半角空格

**示例**:
- ✅ 正确：OpenAI 在 2024 年获得了 130亿美元的融资
- ❌ 错误：open AI在2024年获得了130 亿 美元的融资

### 5. 语言风格一致性
- **专业中文**: 使用流畅、专业的商业中文撰写
- **避免夹杂英文**: 除专有名词、技术术语外，不要在中文句子中夹杂英文单词
- **示例**:
  - ✅ 正确：他们精心剖析...
  - ❌ 错误：他们 meticulously 剖析...

### 6. Markdown 加粗样式规则
- 加粗语法（`**...**`）中只允许纯中文字符（无标点）或纯英文字符（字母、数字）
- 禁止在加粗内容中包含引号、括号或其他标点
- **示例**:
  - ✅ 正确：`**控制平面**`、`**LoadBalancingRouter**`
  - ❌ 错误：`**"控制平面"**`、`**控制平面（Control Plane）**`

### 7. 最终自我校对
在生成所有内容后，请进行一次完整的自我校对：
- 检查所有关键人物姓名是否拼写正确且一致
- 检查所有专有名词的大小写是否正确
- 检查是否有明显的字符错误（如"马S克"应为"马斯克"）
- 检查所有引用的英文原句是否准确无误
- 检查排版格式是否符合上述规范
"""

# 步骤一：生成大纲和标题的提示词模板
OUTLINE_PROMPT_TEMPLATE = """
{base_prompt}

## 输入素材
- {content_type}: 
{full_content}

---
## 当前任务
你的**唯一任务**是根据上方提供的{content_description}，生成这份深度笔记的 **中文标题**、**英文标题**、**引言** 和 **大纲索引**。

## 标题提取/生成规则
1. **英文标题 (title_en)**：
   - 优先从PDF内容中提取原始的英文标题
   - 如果PDF中没有明确的英文标题，则基于内容生成一个简洁、专业的英文标题
   - 英文标题应该准确反映文档的核心主题
   - 格式：简洁的英文短语或句子，不超过15个单词
   - 示例："AI Scaling Laws and 2030 Predictions" 或 "Deep Learning Architecture Guide"

2. **中文标题 (title_cn)**：
   - 基于内容生成一个高度概括核心内容的中文标题
   - 应该具有吸引力和信息量

## 大纲章节设计原则
1. **边界清晰**: 每个章节应该有明确的主题边界，避免章节之间内容重叠或模糊
2. **逻辑连贯**: 章节之间应该有清晰的逻辑递进关系
3. **主题独立**: 每个章节应该聚焦一个核心主题，不要在一个章节中混杂多个不相关的话题
4. **粒度适中**: 章节不宜过细（避免碎片化）也不宜过粗（避免内容过于庞杂），每章应该能够独立成篇
5. **避免跳跃**: 章节顺序应该自然流畅，避免话题突然跳转，确保读者能够顺畅地从一章过渡到下一章
6. **标题明确**: 章节标题应该清晰表达该章的核心内容，让读者一看就知道这一章讲什么

## 特殊格式要求
1. **标题输出**：首先输出JSON格式的标题信息，然后输出Markdown格式的内容
2. **引言**：激发读者阅读兴趣，准确反映整体内容
3. **大纲索引**：最多不超过20个主要章节，每个标题都言之有物，章节之间边界清晰、逻辑连贯
4. **纯文本限制**：章节标题必须是纯文本，**严禁**包含 Markdown 链接格式或方括号 `[]()【】「」`，避免 TOC 跳转失效
5. **格式严格性**：不要添加任何额外的解释或章节内容

## 输出格式
```json
{{
  "title_en": "[提取或生成的英文标题]",
  "title_cn": "[生成的中文标题]"
}}
```

# [中文标题]

### 引言
[这里是引言内容]

### 主要目录
1. [第一章标题]
2. [第二章标题]
...

{quality_control_rules}

---
**请严格遵守上述指令，首先输出JSON格式的标题信息，然后输出标题、引言和大纲索引。**
"""

# 步骤二：生成单个章节内容的提示词模板
CHAPTER_PROMPT_TEMPLATE = """
{base_prompt}

## 全局上下文
- **{content_type}**: {full_content}
- **完整大纲**: 
{full_outline}

{previous_chapters_context}

---
## 当前任务
你的任务是为上述 **完整大纲** 中的**特定一章**撰写详细内容。

**当前章节**：第 `{chapter_number}` 章 - `{current_chapter_title}`

请基于**{content_description}**提供的上下文，并理解当前章节在**完整大纲**中的位置，为其撰写深入、详尽的内容。

## 风格与一致性要求
- **风格统一**: 写作风格、专业口吻和分析深度必须与报告其他部分保持高度一致，把自己想象成正在撰写一部完整作品
- **参考上下文**: 审视上方的**完整大纲**，理解当前章节的承上启下作用
- **术语一致**: 确保专业术语与**原内容**和**基础提示词**中定义的标准保持一致

## 内容去重要求
{deduplication_instruction}

## 章节内容结构
每章应包含以下三个方面的信息，但不要机械地分为三个独立标题，而应该是一个完整、流畅的段落：
- 章节摘要：全面、详细的概括
- 关键论点/数据/案例：精确引用数字与实例
- 深入解读：为什么重要、与现有认知的冲突或补充

## 输出要求
- **只输出**第 `{chapter_number}` 章 **'{current_chapter_title}'** 的完整内容
- **格式关键**：输出必须以 `### {chapter_number}. {current_chapter_title}` (Markdown H3 标题) 开头
- **内容灵活性**：根据章节内容的深度灵活调整，如果内容本身比较浅显，无需强行输出所有三个部分
- **小标题使用**：必要时可以灵活制定小标题帮助阅读理解，但避免使用机械的"章节摘要"、"关键论点/数据/案例"、"深入解读"这类标题
- **范围限制**：不需要包含引言、总结、其他章节或任何无关的文字

{quality_control_rules}

---
**请开始撰写第 `{chapter_number}` 章 - `{current_chapter_title}` 的内容。**
"""

# 步骤三：生成洞见与金句的提示词模板
CONCLUSION_PROMPT_TEMPLATE = """
{base_prompt}

## 全局上下文
- **{content_type}**: {full_content}
- **已生成的全部正文内容**: 
{all_generated_chapters}

---
## 当前任务
你已经完成了报告所有正文章节的撰写。现在，你的任务是基于 **{content_description}** 和 **已生成的全部正文内容**，为整份报告撰写收尾部分。

## 具体任务
请生成以下两个部分：

1. **洞见延伸**：结合行业趋势或学术前沿，给出不多于 10 条具有可操作性的启示
2. **金句&原声引用**：从原内容中挑选不多于 10 条有代表性的原句，并附上精准的中文翻译

## 重要约束
- 输出的"洞见延伸"、"金句&原声引用"必须**结合已生成的全部正文内容**中所提到的内容
- **不要**输出原内容中有但正文内容中没有提到的内容
- 确保与正文的连贯性和一致性

## 输出格式要求
请严格按照以下格式输出，使用 Markdown H3 标题（`###`）：

```markdown
### 洞见延伸
1. [第一条洞见]
2. [第二条洞见]
...

### 金句&原声引用
1. **原文**: "[英文原句]"
   **译文**: [中文翻译]
2. **原文**: "[英文原句]"
   **译文**: [中文翻译]
如果本身就是中文内容，则仅输出中文即可，并且不要输出"**原文**"，直接输出金句即可
...
```

## 重要约束
- 必须使用 `### 洞见延伸` 和 `### 金句&原声引用` 作为标题
- 不要输出其他标题、大纲或任何正文内容
- 确保格式严格符合上述要求

{quality_control_rules}

---
**请开始生成洞见延伸和金句。**
"""
