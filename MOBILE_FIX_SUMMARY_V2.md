# iPad åº”ç”¨åˆ‡æ¢å¯¼è‡´åŠå±æ˜¾ç¤ºé—®é¢˜ - ç»ˆæžä¿®å¤

## é—®é¢˜æè¿°
åœ¨ iPad æ¨ªå±è§‚çœ‹ç½‘é¡µæ—¶ï¼Œä½¿ç”¨ç§»åŠ¨ç«¯ Chrome æµè§ˆå™¨ï¼Œ**é—´æ­‡æ€§**å‡ºçŽ° ReadingView è¢«é™åˆ¶æˆå±å¹•åŠå®½ï¼Œæ•´ä¸ªè§†å£åªå‡ºçŽ°åœ¨å±å¹•çš„å·¦ä¾§ã€‚

**å…³é”®è§¦å‘åœºæ™¯**ï¼šä¸»è¦åœ¨ iPad ä¸Š**åˆ‡æ¢åº”ç”¨ç¨‹åº**æ—¶å®¹æ˜“è§¦å‘åŠå±æ˜¾ç¤ºã€‚

## æ ¹æœ¬åŽŸå› åˆ†æž

### ä¸ºä»€ä¹ˆåˆ‡æ¢åº”ç”¨ä¼šè§¦å‘é—®é¢˜ï¼Ÿ

1. **iOS å¤šä»»åŠ¡å¤„ç†æœºåˆ¶**ï¼š
   - å½“ä½ åˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨æ—¶ï¼ŒSafari/Chrome ä¼šæš‚åœå½“å‰é¡µé¢
   - åˆ‡æ¢å›žæ¥æ—¶ï¼Œæµè§ˆå™¨ä¼šé‡æ–°æ¿€æ´»é¡µé¢å¹¶é‡æ–°è®¡ç®—å¸ƒå±€
   - åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒæŸäº› CSS å˜é‡æˆ–çŠ¶æ€å¯èƒ½è¢«é‡ç½®

2. **é¡µé¢å¯è§æ€§å˜åŒ–**ï¼š
   - åº”ç”¨åˆ‡æ¢ä¼šè§¦å‘ `visibilitychange` äº‹ä»¶
   - é¡µé¢ä»Ž `hidden` å˜ä¸º `visible` æ—¶ï¼Œå¸ƒå±€å¯èƒ½é‡æ–°è®¡ç®—
   - å¦‚æžœæ­¤æ—¶ `isTocVisible` çŠ¶æ€ä¸æ­£ç¡®ï¼Œå°±ä¼šå¯¼è‡´åŠå±æ˜¾ç¤º

3. **å¼‚æ­¥æ¸²æŸ“ç«žæ€**ï¼š
   - é¡µé¢æ¢å¤æ—¶ï¼ŒJavaScript å’Œ CSS çš„æ‰§è¡Œé¡ºåºä¸ç¡®å®š
   - å¯èƒ½å‡ºçŽ° CSS å…ˆæ¸²æŸ“ï¼ˆä½¿ç”¨æ—§çš„ TOC å®½åº¦ï¼‰ï¼ŒJavaScript åŽæ‰§è¡Œçš„æƒ…å†µ

## ç»ˆæžä¿®å¤æ–¹æ¡ˆ

### 1. CSS å±‚ - ä½¿ç”¨ `position: fixed` å¼ºåˆ¶å®šä½

```css
@media (max-width: 768px) {
  /* ä½¿ç”¨ fixed å®šä½ï¼Œå®Œå…¨è„±ç¦»æ–‡æ¡£æµï¼Œä¸å—å…¶ä»–å…ƒç´ å½±å“ */
  .reading-view__content,
  .reading-view__content:not(.reading-view__content--no-toc),
  .reading-view__layout .reading-view__content {
    width: 100vw !important;
    max-width: 100vw !important;
    position: fixed !important; /* å…³é”®ï¼šä½¿ç”¨ fixed è€Œä¸æ˜¯ relative */
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    margin: 0 !important;
    height: 100vh !important;
    transform: none !important;
  }
}
```

**ä¸ºä»€ä¹ˆ `fixed` æ›´å¯é ï¼Ÿ**
- `fixed` å®šä½å®Œå…¨è„±ç¦»æ–‡æ¡£æµï¼Œä¸å—çˆ¶å…ƒç´ å½±å“
- å³ä½¿çˆ¶å…ƒç´ çš„å¸ƒå±€è¢«é‡ç½®ï¼Œ`fixed` å…ƒç´ ä»ç„¶ä¿æŒæ­£ç¡®ä½ç½®
- ä½¿ç”¨ `top: 0; left: 0; right: 0; bottom: 0` ç¡®ä¿å æ»¡æ•´ä¸ªè§†å£

### 2. JavaScript å±‚ - ç›‘å¬åº”ç”¨åˆ‡æ¢äº‹ä»¶

```javascript
// å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–ï¼ˆåº”ç”¨åˆ‡æ¢æ—¶è§¦å‘ï¼‰
const handleVisibilityChange = () => {
  if (document.visibilityState === 'visible') {
    console.log('ðŸ‘ï¸ [DEBUG] é¡µé¢é‡æ–°å¯è§ï¼Œæ£€æŸ¥å¸ƒå±€');
    nextTick(() => {
      const isMobile = window.innerWidth <= 768;
      if (isMobile && isTocVisible.value) {
        console.log('ðŸ“± [DEBUG] åº”ç”¨åˆ‡æ¢åŽæ£€æµ‹åˆ°ç§»åŠ¨ç«¯ï¼Œå¼ºåˆ¶éšè— TOC');
        isTocVisible.value = false;
        emit('toc-toggle', false);
      }
      handleResize();
    });
  }
};

// å¤„ç†é¡µé¢èŽ·å¾—ç„¦ç‚¹ï¼ˆä»Žå…¶ä»–åº”ç”¨åˆ‡æ¢å›žæ¥ï¼‰
const handlePageFocus = () => {
  console.log('ðŸ”„ [DEBUG] é¡µé¢èŽ·å¾—ç„¦ç‚¹');
  setTimeout(() => {
    const isMobile = window.innerWidth <= 768;
    if (isMobile && isTocVisible.value) {
      console.log('ðŸ“± [DEBUG] ç„¦ç‚¹æ¢å¤åŽæ£€æµ‹åˆ°ç§»åŠ¨ç«¯ï¼Œå¼ºåˆ¶éšè— TOC');
      isTocVisible.value = false;
      emit('toc-toggle', false);
    }
    handleResize();
  }, 100); // 100ms å»¶è¿Ÿï¼Œç­‰å¾…æµè§ˆå™¨å®Œæˆæ¸²æŸ“
};

// æ³¨å†Œäº‹ä»¶ç›‘å¬
document.addEventListener('visibilitychange', handleVisibilityChange);
window.addEventListener('focus', handlePageFocus);
window.addEventListener('pageshow', handlePageFocus); // iOS Safari ç‰¹æ®Šå¤„ç†
```

**ç›‘å¬çš„äº‹ä»¶**ï¼š
- `visibilitychange`ï¼šé¡µé¢å¯è§æ€§å˜åŒ–ï¼ˆæœ€å¯é ï¼‰
- `focus`ï¼šçª—å£èŽ·å¾—ç„¦ç‚¹
- `pageshow`ï¼šiOS Safari ç‰¹æ®Šäº‹ä»¶ï¼Œä»ŽåŽå°æ¢å¤æ—¶è§¦å‘

**ä¸ºä»€ä¹ˆéœ€è¦å»¶è¿Ÿï¼Ÿ**
- `setTimeout(fn, 100)` ç»™æµè§ˆå™¨ 100ms æ—¶é—´å®Œæˆå¸ƒå±€æ¸²æŸ“
- é¿å…åœ¨æµè§ˆå™¨è¿˜åœ¨é‡æ–°è®¡ç®—å¸ƒå±€æ—¶å°±ä¿®æ”¹çŠ¶æ€

## å®Œæ•´çš„é˜²å¾¡å±‚çº§

çŽ°åœ¨æˆ‘ä»¬æœ‰ **6 å±‚é˜²å¾¡**ï¼š

1. **CSS Fixed å®šä½å±‚**ï¼ˆæœ€å¼ºï¼‰ï¼šä½¿ç”¨ `position: fixed` å®Œå…¨è„±ç¦»æ–‡æ¡£æµ
2. **åˆå§‹åŒ–å±‚**ï¼šç»„ä»¶åˆå§‹åŒ–æ—¶æ£€æµ‹ç§»åŠ¨ç«¯
3. **è®¡ç®—å±žæ€§å±‚**ï¼š`shouldShowToc` å®žæ—¶æ£€æµ‹
4. **Resize ç›‘å¬å±‚**ï¼šçª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´
5. **Visibility ç›‘å¬å±‚**ï¼ˆæ–°å¢žï¼‰ï¼šåº”ç”¨åˆ‡æ¢æ—¶ä¿®å¤
6. **Props åŒæ­¥å±‚**ï¼šé˜²æ­¢çˆ¶ç»„ä»¶è¦†ç›–

## æµ‹è¯•åœºæ™¯

### é‡ç‚¹æµ‹è¯•ï¼šåº”ç”¨åˆ‡æ¢
1. åœ¨ iPad æ¨ªå±æ¨¡å¼ä¸‹æ‰“å¼€æ–‡ç« 
2. åˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨ï¼ˆå¦‚é‚®ä»¶ã€è®¾ç½®ç­‰ï¼‰
3. åœç•™å‡ ç§’é’Ÿ
4. åˆ‡æ¢å›ž Safari/Chrome
5. **é¢„æœŸç»“æžœ**ï¼šå†…å®¹ä»ç„¶å æ»¡æ•´ä¸ªå±å¹•å®½åº¦

### å…¶ä»–æµ‹è¯•åœºæ™¯
- å¤šæ¬¡å¿«é€Ÿåˆ‡æ¢åº”ç”¨
- åˆ‡æ¢åˆ°åˆ†å±æ¨¡å¼å†åˆ‡å›žå…¨å±
- é”å±åŽè§£é”
- ä»Žé€šçŸ¥ä¸­å¿ƒè¿”å›ž

## è°ƒè¯•æŠ€å·§

æ‰“å¼€æŽ§åˆ¶å°ï¼ŒæŸ¥çœ‹ä»¥ä¸‹æ—¥å¿—ï¼š
- `ðŸ‘ï¸ [DEBUG] é¡µé¢é‡æ–°å¯è§` - æ£€æµ‹åˆ°åº”ç”¨åˆ‡æ¢
- `ðŸ”„ [DEBUG] é¡µé¢èŽ·å¾—ç„¦ç‚¹` - æ£€æµ‹åˆ°ç„¦ç‚¹æ¢å¤
- `ðŸ“± [DEBUG] åº”ç”¨åˆ‡æ¢åŽæ£€æµ‹åˆ°ç§»åŠ¨ç«¯` - æ­£åœ¨ä¿®å¤å¸ƒå±€

## æ€§èƒ½å½±å“

- äº‹ä»¶ç›‘å¬å™¨æ•°é‡ï¼šå¢žåŠ  3 ä¸ªï¼ˆå¯å¿½ç•¥ï¼‰
- å»¶è¿Ÿæ‰§è¡Œï¼š100msï¼ˆç”¨æˆ·æ— æ„ŸçŸ¥ï¼‰
- CSS æ¸²æŸ“ï¼š`position: fixed` æ€§èƒ½æ›´å¥½ï¼ˆGPU åŠ é€Ÿï¼‰

## å¦‚æžœé—®é¢˜ä»ç„¶å­˜åœ¨

å¦‚æžœåœ¨åº”ç”¨åˆ‡æ¢åŽä»ç„¶å‡ºçŽ°åŠå±ï¼Œè¯·ï¼š

1. æ£€æŸ¥æŽ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
2. ç¡®è®¤ `window.innerWidth` çš„å€¼
3. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»– CSS è¦†ç›–äº† `position: fixed`
4. å°è¯•æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

## ç›¸å…³æ–‡ä»¶
- `web/components/views/ReadingView/ReadingView.css` - CSS ä¿®å¤
- `web/components/views/ReadingView/ReadingView.js` - JavaScript ä¿®å¤
