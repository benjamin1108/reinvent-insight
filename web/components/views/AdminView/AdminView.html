<div class="admin-view">
  <!-- 页面标题 -->
  <div class="admin-view__header">
    <h2 class="admin-view__title">
      <svg class="admin-view__title-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      系统管理
    </h2>
  </div>

  <!-- 标签页导航 -->
  <div class="admin-view__tabs">
    <button 
      class="admin-view__tab"
      :class="{ 'admin-view__tab--active': activeTab === 'articles' }"
      @click="activeTab = 'articles'">
      <svg class="admin-view__tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      文章管理
    </button>
    <button 
      class="admin-view__tab"
      :class="{ 'admin-view__tab--active': activeTab === 'trash' }"
      @click="activeTab = 'trash'">
      <svg class="admin-view__tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
      回收站
    </button>
    <button 
      class="admin-view__tab"
      :class="{ 'admin-view__tab--active': activeTab === 'users' }"
      @click="activeTab = 'users'">
      <svg class="admin-view__tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
      </svg>
      用户管理
    </button>
  </div>

  <!-- 文章管理标签页 -->
  <div v-show="activeTab === 'articles'" class="admin-view__content">
    <!-- 工具栏 -->
    <div class="admin-view__toolbar">
      <div class="admin-view__toolbar-left">
        <span class="admin-view__count">共 {{ articles.length }} 篇文章</span>
        <button 
          v-if="selectedArticles.length > 0"
          class="admin-view__batch-btn admin-view__batch-btn--danger"
          @click="handleBatchDelete">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          批量删除 ({{ selectedArticles.length }})
        </button>
      </div>
      <button class="admin-view__refresh-btn" @click="loadArticles" :disabled="loading">
        <svg class="admin-view__refresh-icon" :class="{ 'admin-view__refresh-icon--spin': loading }" 
          fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        刷新
      </button>
    </div>

    <!-- 加载状态 -->
    <div v-if="loading" class="admin-view__loading">
      <div class="admin-view__loading-spinner"></div>
      <p>加载文章列表中...</p>
    </div>

    <!-- 文章表格 -->
    <div v-else-if="articles.length > 0" class="admin-view__table-wrapper">
      <table class="admin-view__table">
        <thead>
          <tr>
            <th class="admin-view__th admin-view__th--checkbox">
              <input 
                type="checkbox" 
                :checked="isAllSelected"
                @change="toggleSelectAll"
                class="admin-view__checkbox">
            </th>
            <th class="admin-view__th admin-view__th--title">标题</th>
            <th class="admin-view__th admin-view__th--type">类型</th>
            <th class="admin-view__th admin-view__th--words">字数</th>
            <th class="admin-view__th admin-view__th--version">版本</th>
            <th class="admin-view__th admin-view__th--date">创建时间</th>
            <th class="admin-view__th admin-view__th--actions">操作</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="article in articles" :key="article.hash" class="admin-view__tr">
            <td class="admin-view__td admin-view__td--checkbox">
              <input 
                type="checkbox" 
                :checked="isArticleSelected(article.hash)"
                @change="toggleArticleSelection(article.hash)"
                class="admin-view__checkbox">
            </td>
            <td class="admin-view__td admin-view__td--title">
              <a @click="handleArticleClick(article)" class="admin-view__article-link">
                <div class="admin-view__article-title">{{ article.title_cn || article.title_en }}</div>
                <div v-if="article.title_cn && article.title_en" class="admin-view__article-subtitle">
                  {{ article.title_en }}
                </div>
              </a>
            </td>
            <td class="admin-view__td admin-view__td--type">
              <span class="admin-view__badge" :class="getTypeBadgeClass(article.source_type)">
                {{ getTypeText(article.source_type) }}
              </span>
            </td>
            <td class="admin-view__td admin-view__td--words">{{ formatWordCount(article.word_count) }}</td>
            <td class="admin-view__td admin-view__td--version">v{{ article.version }}</td>
            <td class="admin-view__td admin-view__td--date">{{ formatDate(article.created_at) }}</td>
            <td class="admin-view__td admin-view__td--actions">
              <div class="admin-view__actions">
                <!-- Ultra Deep 按钮 -->
                <button 
                  v-if="canTriggerUltra(article)"
                  class="admin-view__action-btn admin-view__action-btn--ultra"
                  :disabled="article.ultraGenerating"
                  :title="getUltraButtonTitle(article)"
                  @click="handleTriggerUltra(article)">
                  <svg v-if="!article.ultraGenerating" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  <svg v-else class="admin-view__action-spin" fill="none" viewBox="0 0 24 24" width="16" height="16">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  {{ article.ultraGenerating ? '生成中' : (article.ultraExists ? '已有Ultra' : 'Ultra Deep') }}
                </button>
                <span 
                  v-else-if="article.ultraExists"
                  class="admin-view__action-badge admin-view__action-badge--success"
                  title="已有Ultra DeepInsight版本">
                  ✓ Ultra
                </span>
                <span 
                  v-else
                  class="admin-view__action-badge admin-view__action-badge--disabled"
                  :title="article.ultraDisabledReason">
                  ✗ Ultra
                </span>
                
                <!-- 校对按钮 -->
                <button 
                  class="admin-view__action-btn admin-view__action-btn--proofread"
                  :disabled="article.proofreading || article.chapter_count < 6"
                  :title="getProofreadButtonTitle(article)"
                  @click="handleProofread(article)">
                  <svg v-if="!article.proofreading" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <svg v-else class="admin-view__action-spin" fill="none" viewBox="0 0 24 24" width="16" height="16">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  {{ article.proofreading ? '校对中' : '校对' }}
                </button>
                
                <!-- 删除按钮 -->
                <button 
                  class="admin-view__action-btn admin-view__action-btn--delete"
                  title="删除文章"
                  @click="handleDeleteClick(article)">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  删除
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 空状态 -->
    <div v-else class="admin-view__empty">
      <svg class="admin-view__empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <p class="admin-view__empty-text">暂无文章</p>
    </div>
  </div>

  <!-- 回收站标签页 -->
  <div v-show="activeTab === 'trash'" class="admin-view__content">
    <trash-view
      :items="trashItems"
      :loading="trashLoading"
      @restore="handleRestore"
      @delete="handlePermanentDelete"
      @empty="handleEmptyTrash"
      @load="loadTrash">
    </trash-view>
  </div>

  <!-- 用户管理标签页 -->
  <div v-show="activeTab === 'users'" class="admin-view__content">
    <!-- 工具栏 -->
    <div class="admin-view__toolbar">
      <div class="admin-view__toolbar-left">
        <span class="admin-view__count">共 {{ users.length }} 个用户</span>
      </div>
      <div class="admin-view__toolbar-right">
        <button class="admin-view__refresh-btn" @click="loadUsers" :disabled="usersLoading">
          <svg class="admin-view__refresh-icon" :class="{ 'admin-view__refresh-icon--spin': usersLoading }" 
            fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          刷新
        </button>
        <button class="admin-view__add-user-btn" @click="showAddUserDialog">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          添加用户
        </button>
      </div>
    </div>

    <!-- 加载状态 -->
    <div v-if="usersLoading" class="admin-view__loading">
      <div class="admin-view__loading-spinner"></div>
      <p>加载用户列表中...</p>
    </div>

    <!-- 用户表格 -->
    <div v-else-if="users.length > 0" class="admin-view__table-wrapper">
      <table class="admin-view__table">
        <thead>
          <tr>
            <th class="admin-view__th">用户名</th>
            <th class="admin-view__th">角色</th>
            <th class="admin-view__th">状态</th>
            <th class="admin-view__th">创建时间</th>
            <th class="admin-view__th admin-view__th--actions">操作</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="user in users" :key="user.username" class="admin-view__tr">
            <td class="admin-view__td">
              <div class="admin-view__username">
                <svg v-if="user.role === 'admin'" class="admin-view__admin-icon" fill="currentColor" viewBox="0 0 20 20" width="16" height="16">
                  <path fill-rule="evenodd" d="M9.504 1.132a1 1 0 01.992 0l1.75 1a1 1 0 11-.992 1.736L10 3.152l-1.254.716a1 1 0 11-.992-1.736l1.75-1z" clip-rule="evenodd" />
                  <path fill-rule="evenodd" d="M5.618 4.504a1 1 0 01-.372 1.364L5.016 6l.23.132a1 1 0 11-.992 1.736L4 7.723V8a1 1 0 01-2 0V6a.996.996 0 01.52-.878l1.734-.99a1 1 0 011.364.372zm8.764 0a1 1 0 011.364-.372l1.733.99A1.002 1.002 0 0118 6v2a1 1 0 11-2 0v-.277l-.254.145a1 1 0 11-.992-1.736l.23-.132-.23-.132a1 1 0 01-.372-1.364zm-7 4a1 1 0 011.364-.372L10 8.848l1.254-.716a1 1 0 11.992 1.736L11 10.58V12a1 1 0 11-2 0v-1.42l-1.246-.712a1 1 0 01-.372-1.364zM3 11a1 1 0 011 1v1.42l1.246.712a1 1 0 11-.992 1.736l-1.75-1A1 1 0 012 14v-2a1 1 0 011-1zm14 0a1 1 0 011 1v2a1 1 0 01-.504.868l-1.75 1a1 1 0 11-.992-1.736L16 13.42V12a1 1 0 011-1zm-9.618 5.504a1 1 0 011.364-.372l.254.145V16a1 1 0 112 0v.277l.254-.145a1 1 0 11.992 1.736l-1.735.992a.995.995 0 01-1.022 0l-1.735-.992a1 1 0 01-.372-1.364z" clip-rule="evenodd" />
                </svg>
                {{ user.username }}
              </div>
            </td>
            <td class="admin-view__td">
              <span class="admin-view__badge" :class="user.role === 'admin' ? 'admin-view__badge--admin' : 'admin-view__badge--user'">
                {{ user.role === 'admin' ? '管理员' : '普通用户' }}
              </span>
            </td>
            <td class="admin-view__td">
              <span class="admin-view__badge" :class="user.is_active ? 'admin-view__badge--success' : 'admin-view__badge--disabled'">
                {{ user.is_active ? '正常' : '禁用' }}
              </span>
            </td>
            <td class="admin-view__td">{{ formatDate(user.created_at) }}</td>
            <td class="admin-view__td admin-view__td--actions">
              <div class="admin-view__actions">
                <button 
                  v-if="user.role !== 'admin'"
                  class="admin-view__action-btn admin-view__action-btn--delete"
                  title="删除用户"
                  @click="handleDeleteUser(user)">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  删除
                </button>
                <span v-else class="admin-view__action-badge admin-view__action-badge--disabled" title="管理员账户不可删除">
                  -
                </span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 空状态 -->
    <div v-else class="admin-view__empty">
      <svg class="admin-view__empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
          d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
      </svg>
      <p class="admin-view__empty-text">暂无用户</p>
    </div>
  </div>

  <!-- 删除确认对话框 -->
  <div v-if="deleteConfirmVisible" class="admin-view__modal" @click="cancelDelete">
    <div class="admin-view__modal-content" @click.stop>
      <div class="admin-view__modal-header">
        <h3 class="admin-view__modal-title">确认删除</h3>
      </div>
      <div class="admin-view__modal-body">
        <p v-if="deleteTarget === 'single'">
          确定要删除文章 <strong>{{ articleToDelete?.title_cn || articleToDelete?.title_en }}</strong> 吗？
        </p>
        <p v-else>
          确定要删除选中的 <strong>{{ selectedArticles.length }}</strong> 篇文章吗？
        </p>
        <p class="admin-view__modal-hint">文章将被移动到回收站，可以恢复。</p>
      </div>
      <div class="admin-view__modal-footer">
        <button class="admin-view__modal-btn admin-view__modal-btn--cancel" @click="cancelDelete">
          取消
        </button>
        <button 
          class="admin-view__modal-btn admin-view__modal-btn--danger" 
          :disabled="deleting"
          @click="confirmDelete">
          {{ deleting ? '删除中...' : '确认删除' }}
        </button>
      </div>
    </div>
  </div>

  <!-- 添加用户对话框 -->
  <div v-if="addUserDialogVisible" class="admin-view__modal" @click="cancelAddUser">
    <div class="admin-view__modal-content admin-view__modal-content--wide" @click.stop>
      <div class="admin-view__modal-header">
        <h3 class="admin-view__modal-title">添加用户</h3>
      </div>
      <div class="admin-view__modal-body">
        <div class="admin-view__form-group">
          <label class="admin-view__form-label">用户名</label>
          <input 
            v-model="newUser.username"
            type="text" 
            class="admin-view__form-input"
            placeholder="请输入用户名（3-50个字符）"
            :disabled="addingUser">
          <p v-if="newUserErrors.username" class="admin-view__form-error">{{ newUserErrors.username }}</p>
        </div>
        <div class="admin-view__form-group">
          <label class="admin-view__form-label">密码</label>
          <input 
            v-model="newUser.password"
            type="password" 
            class="admin-view__form-input"
            placeholder="请输入密码（至少6个字符）"
            :disabled="addingUser">
          <p v-if="newUserErrors.password" class="admin-view__form-error">{{ newUserErrors.password }}</p>
        </div>
        <div class="admin-view__form-group">
          <label class="admin-view__form-label">角色</label>
          <select v-model="newUser.role" class="admin-view__form-select" :disabled="addingUser">
            <option value="user">普通用户</option>
            <option value="admin">管理员</option>
          </select>
        </div>
      </div>
      <div class="admin-view__modal-footer">
        <button class="admin-view__modal-btn admin-view__modal-btn--cancel" @click="cancelAddUser" :disabled="addingUser">
          取消
        </button>
        <button 
          class="admin-view__modal-btn admin-view__modal-btn--primary" 
          :disabled="addingUser"
          @click="confirmAddUser">
          {{ addingUser ? '添加中...' : '确认添加' }}
        </button>
      </div>
    </div>
  </div>

  <!-- 删除用户确认对话框 -->
  <div v-if="deleteUserConfirmVisible" class="admin-view__modal" @click="cancelDeleteUser">
    <div class="admin-view__modal-content" @click.stop>
      <div class="admin-view__modal-header">
        <h3 class="admin-view__modal-title">确认删除用户</h3>
      </div>
      <div class="admin-view__modal-body">
        <p>确定要删除用户 <strong>{{ userToDelete?.username }}</strong> 吗？</p>
        <p class="admin-view__modal-hint">该操作无法撤销，用户数据将永久删除。</p>
      </div>
      <div class="admin-view__modal-footer">
        <button class="admin-view__modal-btn admin-view__modal-btn--cancel" @click="cancelDeleteUser" :disabled="deletingUser">
          取消
        </button>
        <button 
          class="admin-view__modal-btn admin-view__modal-btn--danger" 
          :disabled="deletingUser"
          @click="confirmDeleteUser">
          {{ deletingUser ? '删除中...' : '确认删除' }}
        </button>
      </div>
    </div>
  </div>
</div>
