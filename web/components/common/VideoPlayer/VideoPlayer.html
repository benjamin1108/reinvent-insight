<transition name="floating-video-player-fade">
  <div v-if="visible" 
       class="floating-video-player" 
       :class="{ 
         'floating-video-player--minimized': minimized, 
         'floating-video-player--resizing': isResizing, 
         'floating-video-player--dragging': isDragging 
       }"
       :style="{
         left: position.x !== null ? position.x + 'px' : 'auto',
         top: position.y !== null ? position.y + 'px' : 'auto',
         right: position.x !== null ? 'auto' : '20px',
         bottom: position.y !== null ? 'auto' : '20px',
         width: minimized ? '300px' : size.width + 'px',
         height: minimized ? 'auto' : size.height + 'px'
       }">
    
    <!-- 标题栏 -->
    <div class="floating-video-player__header" 
         @mousedown="startDrag" 
         @touchstart="startDrag" 
         @dblclick="toggleMinimize" 
         title="拖动移动位置，双击最小化">
      
      <!-- 视频标题 -->
      <div class="floating-video-player__title">{{ title }}</div>
      
      <!-- 控制按钮 -->
      <div class="floating-video-player__controls">
        <!-- 字幕开关按钮 -->
        <button @click="toggleSubtitle" 
                class="floating-video-player__subtitle-btn"
                :class="{ 
                  'floating-video-player__subtitle-btn--active': subtitleEnabled,
                  'floating-video-player__subtitle-btn--loading': subtitleLoading
                }"
                :title="subtitleButtonTitle"
                :disabled="subtitleLoading">
          CC
        </button>
        
        <!-- 字幕语言切换按钮 -->
        <button v-if="subtitleEnabled"
                @click="toggleSubtitleLang" 
                class="floating-video-player__subtitle-btn"
                :class="{ 'floating-video-player__subtitle-btn--loading': subtitleLoading }"
                :title="subtitleLang === 'zh' ? '切换到英文字幕' : '切换到中文字幕'"
                :disabled="subtitleLoading">
          {{ subtitleLang === 'zh' ? '中' : 'EN' }}
        </button>
        
        <!-- 字幕设置按钮 -->
        <button v-if="subtitleEnabled"
                @click="toggleSubtitleSettings" 
                class="floating-video-player__subtitle-btn"
                :class="{ 'floating-video-player__subtitle-btn--active': showSubtitleSettings }"
                title="字幕设置">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width:14px;height:14px;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
        </button>
        
        <!-- 最小化/恢复按钮 -->
        <button @click="toggleMinimize" 
                class="floating-video-player__control-btn" 
                :title="minimized ? '恢复' : '最小化'">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path v-if="!minimized" 
                  stroke-linecap="round" 
                  stroke-linejoin="round" 
                  stroke-width="2" 
                  d="M20 12H4"></path>
            <path v-else 
                  stroke-linecap="round" 
                  stroke-linejoin="round" 
                  stroke-width="2" 
                  d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
          </svg>
        </button>
        
        <!-- 关闭按钮 -->
        <button @click="close" 
                class="floating-video-player__control-btn" 
                title="关闭">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" 
                  stroke-linejoin="round" 
                  stroke-width="2" 
                  d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- 视频内容区域 -->
    <div v-show="!minimized" class="floating-video-player__content">
      <div :id="iframeContainerId" style="width:100%;height:100%;"></div>
      
      <!-- 字幕叠加层 -->
      <div v-if="subtitleEnabled && currentSubtitle" 
           class="floating-video-player__subtitle"
           :class="{ 
             'floating-video-player__subtitle--hidden': !currentSubtitle,
             'floating-video-player__subtitle--dragging': isSubtitleDragging
           }"
           :style="{ 
             bottom: subtitleBottom + 'px',
             fontSize: subtitleFontSize + 'px',
             color: subtitleColor
           }"
           @mousedown="startSubtitleDrag"
           @touchstart="startSubtitleDrag">
        {{ currentSubtitle }}
      </div>
      
      <!-- 字幕设置面板 -->
      <div v-if="showSubtitleSettings" class="floating-video-player__subtitle-settings">
        <div class="floating-video-player__settings-title">字幕设置</div>
        
        <!-- 字体大小 -->
        <div class="floating-video-player__settings-row">
          <span class="floating-video-player__settings-label">字体大小</span>
          <div class="floating-video-player__settings-controls">
            <button @click="decreaseSubtitleSize" class="floating-video-player__settings-btn" :disabled="subtitleFontSize <= 12">-</button>
            <span class="floating-video-player__settings-value">{{ subtitleFontSize }}px</span>
            <button @click="increaseSubtitleSize" class="floating-video-player__settings-btn" :disabled="subtitleFontSize >= 32">+</button>
          </div>
        </div>
        
        <!-- 字幕颜色 -->
        <div class="floating-video-player__settings-row">
          <span class="floating-video-player__settings-label">字幕颜色</span>
          <div class="floating-video-player__color-options">
            <button v-for="color in colorOptions" 
                    :key="color.value"
                    @click="setSubtitleColor(color.value)"
                    class="floating-video-player__color-btn"
                    :class="{ 'floating-video-player__color-btn--active': subtitleColor === color.value }"
                    :style="{ backgroundColor: color.value }"
                    :title="color.name">
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 调整大小手柄 -->
    <div v-show="!minimized" 
         class="floating-video-player__resize-handle" 
         @mousedown="startResize"></div>
  </div>
</transition> 