<!-- 普通页面Header -->
<header v-if="mode === 'normal'"
  class="app-header tech-gradient border-b border-gray-800 shadow-lg sticky top-0 z-40">
  <div class="app-header__container app-header__mobile">
    <div class="app-header__left">
      <div class="app-header__left-inner">
        <!-- 品牌标识 -->
        <a @click="handleHomeClick" class="app-header__brand">
          <svg class="w-7 h-7 text-cyan-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
          <h1 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">
            reinvent <span class="text-purple-400">Insight</span>
          </h1>
        </a>
        
        <!-- 桌面端主导航 -->
        <div class="app-header__nav">
          <tech-button 
            v-if="isAuthenticated"
            variant="secondary" 
            :class="{ 'active': currentView === 'create' }"
            @click="handleViewChange('create')">
            新解读
          </tech-button>
          <tech-button 
            variant="secondary" 
            :class="{ 'active': currentView === 'recent' }"
            @click="handleViewChange('recent')">
            最近文章
          </tech-button>
          <tech-button 
            variant="secondary" 
            :class="{ 'active': currentView === 'library' }"
            @click="handleViewChange('library')">
            笔记库
          </tech-button>
        </div>
      </div>
      
      <!-- 移动端登录/退出按钮 -->
      <div class="app-header__mobile-auth">
        <tech-button 
          v-if="!isAuthenticated" 
          variant="secondary"
          @click="handleLoginShow">
          登录
        </tech-button>
        <tech-button 
          v-else 
          variant="danger"
          @click="handleLogout">
          退出
        </tech-button>
      </div>
    </div>
    
    <!-- 移动端导航 -->
    <div class="app-header__mobile-nav">
      <tech-button 
        v-if="isAuthenticated"
        variant="secondary" 
        full-width
        :class="{ 'active': currentView === 'create' }"
        @click="handleViewChange('create')">
        新解读
      </tech-button>
      <tech-button 
        variant="secondary" 
        full-width
        :class="{ 'active': currentView === 'recent' }"
        @click="handleViewChange('recent')">
        最近文章
      </tech-button>
      <tech-button 
        variant="secondary" 
        full-width
        :class="{ 'active': currentView === 'library' }"
        @click="handleViewChange('library')">
        笔记库
      </tech-button>
    </div>
    
    <!-- 桌面端右侧操作区 -->
    <div class="app-header__actions">
      <!-- 临时测试Toast按钮 -->
      <tech-button 
        v-if="showTestToast" 
        variant="warning"
        @click="handleTestToast">
        测试Toast
      </tech-button>
      
      <!-- 登录/退出按钮 -->
      <tech-button 
        v-if="!isAuthenticated" 
        variant="primary"
        @click="handleLoginShow">
        登录
      </tech-button>
      <tech-button 
        v-else 
        variant="danger"
        @click="handleLogout">
        退出
      </tech-button>
    </div>
  </div>
</header>

<!-- 阅读页面Header -->
<header v-else-if="mode === 'reading'"
  class="app-header tech-gradient border-b border-gray-800 shadow-lg sticky top-0 z-40 app-header--reading">
  <div class="app-header__container app-header__content">
    <!-- 左侧品牌和操作区 -->
    <div class="app-header__reading-left">
      <!-- 品牌标识 -->
      <a @click="handleHomeClick" class="app-header__brand">
        <svg class="w-7 h-7 text-cyan-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
        <h1 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">
          reinvent <span class="text-purple-400">Insight</span>
        </h1>
      </a>

      <!-- 桌面端操作按钮组 -->
      <div class="app-header__reading-controls">
        <!-- 返回按钮 -->
        <tech-button 
          v-if="!isShareView" 
          variant="secondary" 
          icon-before="M10 19l-7-7m0 0l7-7m-7 7h18"
          @click="handleBackToLibrary">
          返回笔记库
        </tech-button>

        <!-- 观看原视频按钮 -->
        <tech-button 
          v-if="readingVideoUrl" 
          variant="secondary" 
          icon-before="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
          @click="handleOpenVideo">
          观看原视频
        </tech-button>

        <!-- 下载PDF按钮 - 仅在 Deep Insight 模式显示 -->
        <tech-button 
          v-if="displayMode !== 'quick'"
          variant="secondary" 
          :loading="pdfDownloading"
          :icon-before="pdfDownloading ? '' : 'M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z'"
          loading-text="生成中..."
          @click="handleDownloadPDF">
          {{ pdfDownloading ? '生成中...' : '下载PDF' }}
        </tech-button>

        <!-- 下载Markdown按钮 - 仅在 Deep Insight 模式显示 -->
        <tech-button 
          v-if="displayMode !== 'quick'"
          variant="secondary" 
          :loading="markdownDownloading"
          :icon-before="markdownDownloading ? '' : 'M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z'"
          loading-text="下载中..."
          @click="handleDownloadMarkdown">
          {{ markdownDownloading ? '下载中...' : '下载MD' }}
        </tech-button>

        <!-- 下载长图按钮 - 仅在 Visual Insight 模式显示 -->
        <tech-button 
          v-if="displayMode === 'quick'"
          variant="secondary" 
          :loading="longImageGenerating"
          :icon-before="longImageGenerating ? '' : 'M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z'"
          loading-text="生成中..."
          @click="handleDownloadLongImage">
          {{ longImageGenerating ? '生成中...' : '下载长图' }}
        </tech-button>

        <!-- 目录切换按钮 - 仅在 Deep 模式显示 -->
        <tech-button 
          v-if="displayMode !== 'quick'"
          variant="secondary" 
          min-width="80px"
          :icon-before="showToc ? 'M6 18L18 6M6 6l12 12' : 'M4 6h16M4 12h16M4 18h7'"
          :title="showToc ? '隐藏目录' : '显示目录'"
          @click="handleToggleToc">
          目录
        </tech-button>

        <!-- iOS 风格模式切换开关 - 仅在有 Visual 时显示 -->
        <mode-toggle
          v-if="visualAvailable"
          :current-mode="displayMode"
          :visual-available="visualAvailable"
          :visual-status="visualStatus"
          :compact="true"
          @mode-change="handleModeChange">
        </mode-toggle>

        <!-- 音频播放按钮 - 仅在 Deep 模式显示 -->
        <simple-audio-button 
          v-if="audioButtonEnabled && articleHash && articleText && displayMode !== 'quick'"
          :article-hash="articleHash"
          :article-text="articleText"
          class="app-header__audio-btn">
        </simple-audio-button>
      </div>
    </div>
    
    <!-- 右侧操作区（移动端） -->
    <div class="app-header__right">
      <!-- 移动端工具栏 -->
      <div class="app-header__mobile-toolbar">
        <!-- 观看视频按钮 -->
        <button 
          v-if="readingVideoUrl"
          class="app-header__mobile-icon-btn"
          title="观看原视频"
          @click="handleOpenVideo">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
        </button>
        
        <!-- 下载按钮 - Deep模式下载PDF -->
        <button 
          v-if="displayMode !== 'quick'"
          class="app-header__mobile-icon-btn"
          :class="{ 'app-header__mobile-icon-btn--loading': pdfDownloading }"
          :disabled="pdfDownloading"
          title="下载PDF"
          @click="handleDownloadPDF">
          <svg v-if="!pdfDownloading" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <svg v-else class="app-header__mobile-icon-spin" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </button>
        
        <!-- 下载长图按钮 - Visual模式 -->
        <button 
          v-if="displayMode === 'quick'"
          class="app-header__mobile-icon-btn"
          :class="{ 'app-header__mobile-icon-btn--loading': longImageGenerating }"
          :disabled="longImageGenerating"
          title="下载长图"
          @click="handleDownloadLongImage">
          <svg v-if="!longImageGenerating" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <svg v-else class="app-header__mobile-icon-spin" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </button>
        
        <!-- ModeToggle -->
        <mode-toggle
          v-if="visualAvailable"
          :current-mode="displayMode"
          :visual-available="visualAvailable"
          :visual-status="visualStatus"
          :compact="true"
          class="app-header__mobile-mode-toggle"
          @mode-change="handleModeChange">
        </mode-toggle>
      </div>
      
      <!-- 移动端返回按钮 -->
      <tech-button 
        v-if="!isShareView" 
        variant="secondary" 
        icon-before="M10 19l-7-7m0 0l7-7m-7 7h18"
        class="app-header__mobile-back"
        @click="handleBackToLibrary">
        返回
      </tech-button>
    </div>
  </div>
</header> 