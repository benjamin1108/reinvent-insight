<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechButtoné›†æˆæµ‹è¯• - reinvent-insight</title>
    
    <!-- åŸºç¡€æ ·å¼æ–‡ä»¶ - æŒ‰é‡æ„åçš„æ¶æ„å¼•å…¥ -->
    <link rel="stylesheet" href="../css/base/typography.css">
    <link rel="stylesheet" href="../css/base/effects.css">  
    <link rel="stylesheet" href="../css/base/content.css">
    
    <style>
        /* CSSé‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
            color: #e5e7eb;
            font-family: 'JetBrains Mono', 'Consolas', 'SFMono-Regular', Menlo, monospace, 'PingFang SC', 'Microsoft YaHei', sans-serif;
            line-height: 1.5;
        }
        
        /* åŸºç¡€å…ƒç´ é‡ç½® */
        h1, h2, h3, h4, h5, h6 {
            margin: 0;
            font-weight: inherit;
        }
        
        p {
            margin: 0;
        }
        
        button {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            font: inherit;
            color: inherit;
            cursor: pointer;
        }
        
        input {
            font: inherit;
            color: inherit;
        }
        
        a {
            text-decoration: none;
            color: inherit;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .test-section {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #374151;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }
        
        .test-section h2 {
            color: #22d3ee;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        .component-demo {
            border: 1px solid #4b5563;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            background: rgba(17, 24, 39, 0.5);
        }
        
        .component-demo h3 {
            color: #f59e0b;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .demo-content {
            padding: 1rem 0;
        }
        
        #event-log {
            height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #374151;
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
        }
        
        .log-entry {
            margin-bottom: 0.25rem;
            color: #94a3b8;
        }
        
        .log-entry.success {
            color: #10b981;
        }
        
        .log-entry.error {
            color: #ef4444;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
    </style>
    <script src="../js/vendor/vue.global.prod.min.js"></script>
</head>
<body>
    <div id="app" class="test-container">
        <h1 style="text-align: center; color: #22d3ee; margin-bottom: 2rem; font-size: 2rem;">
            TechButton ç»Ÿä¸€æŒ‰é’®ç»„ä»¶é›†æˆæµ‹è¯•
        </h1>
        
        <!-- AppHeader ç»„ä»¶æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”§ AppHeader ç»„ä»¶</h2>
            <div class="component-demo">
                <h3>æ™®é€šæ¨¡å¼</h3>
                <div class="demo-content">
                    <app-header 
                        mode="normal"
                        :is-authenticated="isAuthenticated"
                        current-view="create"
                        :show-test-toast="true"
                        @home-click="logEvent('AppHeader: é¦–é¡µç‚¹å‡»')"
                        @view-change="logEvent('AppHeader: è§†å›¾åˆ‡æ¢ - ' + $event)"
                        @login-show="logEvent('AppHeader: æ˜¾ç¤ºç™»å½•')"
                        @logout="logEvent('AppHeader: é€€å‡ºç™»å½•')"
                        @test-toast="logEvent('AppHeader: æµ‹è¯•Toast')">
                    </app-header>
                </div>
            </div>
            
            <div class="component-demo">
                <h3>é˜…è¯»æ¨¡å¼</h3>
                <div class="demo-content">
                    <app-header 
                        mode="reading"
                        :is-authenticated="true"
                        :is-share-view="false"
                        :show-toc="showToc"
                        reading-video-url="https://example.com/video"
                        :pdf-downloading="pdfDownloading"
                        @back-to-library="logEvent('AppHeader: è¿”å›ç¬”è®°åº“')"
                        @open-video="logEvent('AppHeader: æ‰“å¼€è§†é¢‘')"
                        @download-pdf="handlePdfDownload"
                        @toggle-toc="handleToggleToc">
                    </app-header>
                </div>
            </div>
        </div>
        
        <!-- HeroSection ç»„ä»¶æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸš€ HeroSection ç»„ä»¶</h2>
            <div class="component-demo">
                <h3>æœªç™»å½•çŠ¶æ€</h3>
                <div class="demo-content">
                    <hero-section 
                        :is-authenticated="false"
                        @login-click="logEvent('HeroSection: ç™»å½•ç‚¹å‡»')">
                    </hero-section>
                </div>
            </div>
        </div>
        
        <!-- CreateView ç»„ä»¶æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“ CreateView ç»„ä»¶</h2>
            <div class="component-demo">
                <h3>åˆ†æç•Œé¢</h3>
                <div class="demo-content">
                    <create-view 
                        v-model:url="videoUrl"
                        :loading="createLoading"
                        :progress-percent="progressPercent"
                        :logs="logs"
                        :finalized-logs="finalizedLogs"
                        :summary="summary"
                        title="æµ‹è¯•è§†é¢‘è§£è¯»"
                        rendered="<p>è¿™é‡Œæ˜¯æ¸²æŸ“çš„å†…å®¹...</p>"
                        @start-analysis="handleStartAnalysis"
                        @view-summary="logEvent('CreateView: æŸ¥çœ‹æ‘˜è¦')">
                    </create-view>
                </div>
            </div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="test-section">
            <h2>ğŸ›ï¸ æ§åˆ¶é¢æ¿</h2>
            <div class="grid">
                <div>
                    <h3>çŠ¶æ€æ§åˆ¶</h3>
                    <div style="margin: 1rem 0;">
                        <label style="display: block; margin-bottom: 0.5rem;">
                            <input type="checkbox" v-model="isAuthenticated" style="margin-right: 0.5rem;">
                            ç”¨æˆ·å·²è®¤è¯
                        </label>
                        <label style="display: block; margin-bottom: 0.5rem;">
                            <input type="checkbox" v-model="showToc" style="margin-right: 0.5rem;">
                            æ˜¾ç¤ºç›®å½•
                        </label>
                        <label style="display: block; margin-bottom: 0.5rem;">
                            <input type="checkbox" v-model="pdfDownloading" style="margin-right: 0.5rem;">
                            PDFä¸‹è½½ä¸­
                        </label>
                        <label style="display: block; margin-bottom: 0.5rem;">
                            <input type="checkbox" v-model="createLoading" style="margin-right: 0.5rem;">
                            åˆ†æåŠ è½½ä¸­
                        </label>
                    </div>
                    
                    <div style="margin: 1rem 0;">
                        <label style="display: block; margin-bottom: 0.5rem;">
                            è¿›åº¦ç™¾åˆ†æ¯”ï¼š{{ progressPercent }}%
                        </label>
                        <input type="range" v-model="progressPercent" min="0" max="100" style="width: 100%;">
                    </div>
                </div>
                
                <div>
                    <h3>äº‹ä»¶æ—¥å¿—</h3>
                    <div id="event-log" ref="eventLog">
                        <div v-for="(entry, index) in eventLog" :key="index" :class="['log-entry', entry.type]">
                            [{{ entry.time }}] {{ entry.message }}
                        </div>
                    </div>
                    <button @click="clearLog" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: #374151; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                        æ¸…ç©ºæ—¥å¿—
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç»„ä»¶åŠ è½½è„šæœ¬ -->
    <script src="../js/core/event-bus.js"></script>
    <script src="../js/core/component-loader.js"></script>
    
    <script type="module">
        const { createApp } = Vue;
        
        let vueApp; // å£°æ˜å˜é‡æ¥å­˜å‚¨Vueåº”ç”¨å®ä¾‹
        
        const app = createApp({
            data() {
                return {
                    // çŠ¶æ€æ§åˆ¶
                    isAuthenticated: false,
                    showToc: true,
                    pdfDownloading: false,
                    createLoading: false,
                    progressPercent: 0,
                    
                    // CreateView ç›¸å…³æ•°æ®
                    videoUrl: 'https://www.youtube.com/watch?v=example',
                    logs: ['åˆå§‹åŒ–...', 'å‡†å¤‡åˆ†æ...'],
                    finalizedLogs: ['ç³»ç»Ÿå‡†å¤‡å®Œæˆ'],
                    summary: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ‘˜è¦å†…å®¹...',
                    
                    // äº‹ä»¶æ—¥å¿—
                    eventLog: []
                };
            },
            
            methods: {
                logEvent(message, type = 'success') {
                    const time = new Date().toLocaleTimeString();
                    this.eventLog.push({ time, message, type });
                    
                    // æ»šåŠ¨åˆ°åº•éƒ¨
                    this.$nextTick(() => {
                        const logElement = this.$refs.eventLog;
                        if (logElement) {
                            logElement.scrollTop = logElement.scrollHeight;
                        }
                    });
                },
                
                clearLog() {
                    this.eventLog = [];
                },
                
                handlePdfDownload() {
                    this.pdfDownloading = true;
                    this.logEvent('AppHeader: å¼€å§‹ä¸‹è½½PDF');
                    
                    setTimeout(() => {
                        this.pdfDownloading = false;
                        this.logEvent('AppHeader: PDFä¸‹è½½å®Œæˆ');
                    }, 3000);
                },
                
                handleToggleToc() {
                    this.showToc = !this.showToc;
                    this.logEvent(`AppHeader: åˆ‡æ¢ç›®å½•æ˜¾ç¤º - ${this.showToc ? 'æ˜¾ç¤º' : 'éšè—'}`);
                },
                
                handleStartAnalysis(url) {
                    this.createLoading = true;
                    this.progressPercent = 0;
                    this.logs = ['å¼€å§‹åˆ†æ...'];
                    this.logEvent(`CreateView: å¼€å§‹åˆ†æ - ${url}`);
                    
                    // æ¨¡æ‹Ÿè¿›åº¦
                    const interval = setInterval(() => {
                        this.progressPercent += 10;
                        this.logs.push(`åˆ†æè¿›åº¦: ${this.progressPercent}%`);
                        
                        if (this.progressPercent >= 100) {
                            clearInterval(interval);
                            this.createLoading = false;
                            this.finalizedLogs = [...this.logs];
                            this.logEvent('CreateView: åˆ†æå®Œæˆ');
                        }
                    }, 500);
                }
            },
            
            async mounted() {
                this.logEvent('é¡µé¢åˆå§‹åŒ–å®Œæˆ', 'success');
                
                // æ”¹è¿›çš„æµ‹è¯•ä¸“ç”¨ç»„ä»¶åŠ è½½å™¨ï¼Œæ”¯æŒä¾èµ–å¤„ç†
                const loadTestComponent = async (name, path, fileName) => {
                    try {
                        // å¹¶è¡ŒåŠ è½½ HTMLã€CSS å’Œ JS
                        const [htmlResponse, cssResponse] = await Promise.all([
                            fetch(`${path}/${fileName}.html`),
                            fetch(`${path}/${fileName}.css`).catch(() => null)
                        ]);
                        
                        if (!htmlResponse.ok) {
                            throw new Error(`æ— æ³•åŠ è½½ç»„ä»¶HTML: ${name}`);
                        }
                        
                        const html = await htmlResponse.text();
                        const css = cssResponse?.ok ? await cssResponse.text() : '';
                        
                        // åŠ¨æ€å¯¼å…¥JSæ¨¡å—
                        const jsModule = await import(`${path}/${fileName}.js`);
                        
                        // æ³¨å…¥ç»„ä»¶æ ·å¼
                        if (css && !document.querySelector(`[data-component-style="${name}"]`)) {
                            const style = document.createElement('style');
                            style.setAttribute('data-component-style', name);
                            style.textContent = css;
                            document.head.appendChild(style);
                        }
                        
                        // å¤„ç†ç»„ä»¶ä¾èµ–
                        const componentConfig = jsModule.default;
                        if (componentConfig.dependencies) {
                            this.logEvent(`ç»„ä»¶ ${name} éœ€è¦ä¾èµ–: ${componentConfig.dependencies.map(d => d[0]).join(', ')}`, 'success');
                            
                            for (const [depName, depPath, depFileName] of componentConfig.dependencies) {
                                // æ£€æŸ¥ä¾èµ–æ˜¯å¦å·²ç»æ³¨å†Œ
                                if (!vueApp._context.components[depName]) {
                                    this.logEvent(`åŠ è½½ä¾èµ–ç»„ä»¶: ${depName}`, 'success');
                                    // è½¬æ¢è·¯å¾„ï¼šç»å¯¹è·¯å¾„è½¬ä¸ºç›¸å¯¹è·¯å¾„
                                    const relativePath = depPath.startsWith('/') ? '..' + depPath : depPath;
                                    await loadTestComponent(depName, relativePath, depFileName);
                                }
                            }
                        }
                        
                        // åˆ›å»ºç»„ä»¶å®šä¹‰ï¼ˆç§»é™¤dependenciesï¼Œé¿å…Vueå¤„ç†æ—¶å‡ºé”™ï¼‰
                        const componentDef = {
                            name,
                            template: html,
                            ...componentConfig
                        };
                        delete componentDef.dependencies; // ç§»é™¤dependenciesé…ç½®
                        
                        // æ³¨å†Œåˆ°Vueåº”ç”¨
                        vueApp.component(name, componentDef);
                        
                        this.logEvent(`ç»„ä»¶ ${name} åŠ è½½æˆåŠŸ`, 'success');
                        return true;
                    } catch (error) {
                        this.logEvent(`ç»„ä»¶ ${name} åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                        console.error(`ç»„ä»¶ ${name} åŠ è½½å¤±è´¥:`, error);
                        return false;
                    }
                };
                
                // åŠ è½½ç»„ä»¶ï¼ˆä¾èµ–ä¼šè‡ªåŠ¨å¤„ç†ï¼‰
                const components = [
                    ['app-header', '../components/common/AppHeader', 'AppHeader'],
                    ['hero-section', '../components/views/HeroSection', 'HeroSection'],  
                    ['create-view', '../components/views/CreateView', 'CreateView']
                ];
                
                let successCount = 0;
                for (const [name, path, fileName] of components) {
                    const success = await loadTestComponent(name, path, fileName);
                    if (success) successCount++;
                }
                
                this.logEvent(`ä¸»è¦ç»„ä»¶åŠ è½½å®Œæˆ: ${successCount}/${components.length} ä¸ªæˆåŠŸ`, successCount === components.length ? 'success' : 'error');
                
                // æ˜¾ç¤ºå·²æ³¨å†Œçš„æ‰€æœ‰ç»„ä»¶
                const registeredComponents = Object.keys(vueApp._context.components);
                this.logEvent(`å·²æ³¨å†Œç»„ä»¶: ${registeredComponents.join(', ')}`, 'success');
            }
        });
        
        vueApp = app; // ä¿å­˜Vueåº”ç”¨å®ä¾‹
        app.mount('#app');
    </script>
</body>
</html> 