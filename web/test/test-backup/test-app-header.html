<!DOCTYPE html>
<html lang="zh-CN" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AppHeader组件测试 - reinvent Insight</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet" />
  <script src="/js/vendor/vue.global.prod.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 核心脚本 -->
  <script src="/js/core/component-loader.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
      background-attachment: fixed;
      min-height: 100vh;
      color: #e5e7eb;
    }
    
    .test-controls {
      background: rgba(17, 24, 39, 0.8);
      border: 1px solid #374151;
      border-radius: 12px;
      padding: 2rem;
      margin: 2rem;
      backdrop-filter: blur(10px);
    }
    
    .control-group {
      margin-bottom: 1.5rem;
    }
    
    .control-label {
      display: block;
      color: #d1d5db;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .control-select {
      width: 100%;
      max-width: 300px;
      padding: 0.5rem;
      background: rgba(17, 24, 39, 0.8);
      border: 1px solid #4b5563;
      border-radius: 4px;
      color: white;
      font-size: 0.875rem;
    }
    
    .test-button {
      padding: 0.75rem 1.5rem;
      background: linear-gradient(to right, #06b6d4, #3b82f6);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.875rem;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.2s;
      margin-right: 1rem;
      margin-bottom: 1rem;
    }
    
    .test-button:hover {
      transform: scale(1.05);
      opacity: 0.9;
    }
    
    .test-button:active {
      transform: scale(0.98);
    }
    
    .event-log {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #1f2937;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .log-item {
      color: #d1d5db;
      font-size: 0.875rem;
      margin-bottom: 0.25rem;
      font-family: monospace;
    }
    
    .checkbox-label {
      display: flex;
      align-items: center;
      color: #d1d5db;
      font-size: 0.875rem;
      cursor: pointer;
      margin-bottom: 1rem;
    }
    
    .checkbox-label input {
      margin-right: 0.5rem;
    }
    
    .demo-content {
      min-height: 80vh;
      background: rgba(30, 41, 59, 0.3);
      margin: 2rem;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      color: #94a3b8;
    }
  </style>
</head>

<body class="h-full bg-gray-900 text-gray-200">
  <div id="app" class="h-full flex flex-col">
    
    <!-- AppHeader 组件 -->
    <app-header
      :mode="headerMode"
      :is-authenticated="isAuthenticated"
      :is-share-view="isShareView"
      :current-view="currentView"
      :show-test-toast="showTestToast"
      :show-toc="showToc"
      :reading-video-url="readingVideoUrl"
      :pdf-downloading="pdfDownloading"
      @home-click="handleHomeClick"
      @view-change="handleViewChange"
      @login-show="handleLoginShow"
      @logout="handleLogout"
      @test-toast="handleTestToast"
      @back-to-library="handleBackToLibrary"
      @open-video="handleOpenVideo"
      @download-pdf="handleDownloadPDF"
      @toggle-toc="handleToggleToc">
    </app-header>

    <!-- 控制面板和内容区域 -->
    <div class="flex-1 flex">
      <!-- 左侧控制面板 -->
      <div class="w-80 flex-shrink-0">
        <div class="test-controls">
          <h2 class="text-xl font-semibold mb-4 text-cyan-400">AppHeader 测试控制面板</h2>
          
          <div class="control-group">
            <label class="control-label">Header模式</label>
            <select v-model="headerMode" class="control-select">
              <option value="normal">普通页面模式</option>
              <option value="reading">阅读页面模式</option>
            </select>
          </div>
          
          <div class="control-group">
            <label class="control-label">当前视图</label>
            <select v-model="currentView" class="control-select">
              <option value="home">首页</option>
              <option value="create">创建</option>
              <option value="library">笔记库</option>
              <option value="read">阅读</option>
            </select>
          </div>
          
          <div class="control-group">
            <label class="checkbox-label">
              <input type="checkbox" v-model="isAuthenticated">
              用户已登录
            </label>
          </div>
          
          <div class="control-group">
            <label class="checkbox-label">
              <input type="checkbox" v-model="isShareView">
              分享页面模式
            </label>
          </div>
          
          <div class="control-group">
            <label class="checkbox-label">
              <input type="checkbox" v-model="showTestToast">
              显示测试Toast按钮
            </label>
          </div>
          
          <!-- 阅读模式特有控制 -->
          <div v-if="headerMode === 'reading'" class="control-group">
            <h3 class="text-lg font-medium mb-2 text-purple-400">阅读模式设置</h3>
            
            <label class="checkbox-label">
              <input type="checkbox" v-model="showToc">
              显示目录
            </label>
            
            <label class="checkbox-label">
              <input type="checkbox" v-model="hasVideo">
              有视频链接
            </label>
            
            <label class="checkbox-label">
              <input type="checkbox" v-model="pdfDownloading">
              PDF下载中
            </label>
          </div>
          
          <div class="mt-4">
            <button @click="resetStates" class="test-button">重置状态</button>
            <button @click="toggleAuth" class="test-button">切换登录状态</button>
            <button @click="clearLogs" class="test-button">清空日志</button>
          </div>
          
          <div class="control-group">
            <label class="checkbox-label">
              <input type="checkbox" v-model="showDebugInfo">
              显示调试信息
            </label>
          </div>
          
          <div v-if="showDebugInfo" class="mt-4 p-3 bg-gray-800 rounded text-sm">
            <h3 class="text-purple-400 mb-2">当前状态</h3>
            <div><strong>模式:</strong> {{ headerMode }}</div>
            <div><strong>视图:</strong> {{ currentView }}</div>
            <div><strong>认证:</strong> {{ isAuthenticated ? '已登录' : '未登录' }}</div>
            <div><strong>分享:</strong> {{ isShareView ? '是' : '否' }}</div>
            <div v-if="headerMode === 'reading'">
              <div><strong>目录:</strong> {{ showToc ? '显示' : '隐藏' }}</div>
              <div><strong>视频:</strong> {{ hasVideo ? '有' : '无' }}</div>
              <div><strong>PDF:</strong> {{ pdfDownloading ? '下载中' : '空闲' }}</div>
            </div>
          </div>

          <!-- 事件日志 -->
          <div class="event-log">
            <h3 class="text-lg font-semibold mb-2 text-cyan-400">事件日志</h3>
            <div v-for="(log, index) in eventLogs" :key="index" class="log-item">
              [{{ log.time }}] {{ log.message }}
            </div>
            <div v-if="eventLogs.length === 0" class="log-item text-gray-500">
              暂无事件日志
            </div>
          </div>
        </div>
      </div>

      <!-- 右侧演示内容区域 -->
      <div class="flex-1">
        <div class="demo-content">
          <div class="text-center">
            <h2 class="text-2xl font-bold mb-4">AppHeader 组件演示</h2>
            <p class="mb-2">当前模式: <span class="text-cyan-400">{{ headerMode }}</span></p>
            <p class="mb-2">当前视图: <span class="text-cyan-400">{{ currentView }}</span></p>
            <p>用户状态: <span class="text-cyan-400">{{ isAuthenticated ? '已登录' : '未登录' }}</span></p>
            
            <div class="mt-8 p-4 bg-gray-800 rounded-lg max-w-md mx-auto">
              <h3 class="text-lg font-semibold mb-2 text-purple-400">测试说明</h3>
              <ul class="text-sm text-left space-y-1">
                <li>• 切换不同模式查看Header样式变化</li>
                <li>• 改变登录状态观察按钮显示</li>
                <li>• 在阅读模式下测试各种功能按钮</li>
                <li>• 调整浏览器窗口测试响应式设计</li>
                <li>• 查看事件日志了解交互反馈</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    const { createApp, ref, reactive, computed, onMounted, getCurrentInstance } = Vue;
    
    const app = createApp({
      setup() {
        // 状态管理
        const headerMode = ref('normal');
        const isAuthenticated = ref(false);
        const isShareView = ref(false);
        const currentView = ref('home');
        const showTestToast = ref(true);
        const showToc = ref(true);
        const hasVideo = ref(true);
        const pdfDownloading = ref(false);
        const showDebugInfo = ref(false);
        const eventLogs = ref([]);
        
        // 计算属性
        const readingVideoUrl = computed(() => {
          return hasVideo.value ? 'https://www.youtube.com/watch?v=example' : '';
        });
        
        // 方法
        const addLog = (message) => {
          eventLogs.value.push({
            time: new Date().toLocaleTimeString(),
            message
          });
          
          // 限制日志数量
          if (eventLogs.value.length > 50) {
            eventLogs.value = eventLogs.value.slice(-50);
          }
        };
        
        // 事件处理
        const handleHomeClick = () => {
          addLog('点击首页/品牌标识');
          currentView.value = 'home';
        };
        
        const handleViewChange = (view) => {
          addLog(`视图切换: ${view}`);
          currentView.value = view;
        };
        
        const handleLoginShow = () => {
          addLog('显示登录框');
        };
        
        const handleLogout = () => {
          addLog('用户退出登录');
          isAuthenticated.value = false;
        };
        
        const handleTestToast = () => {
          addLog('测试Toast按钮点击');
        };
        
        const handleBackToLibrary = () => {
          addLog('返回笔记库');
          currentView.value = 'library';
        };
        
        const handleOpenVideo = () => {
          addLog('打开视频播放器');
        };
        
        const handleDownloadPDF = () => {
          addLog('开始下载PDF');
          pdfDownloading.value = true;
          
          // 模拟下载过程
          setTimeout(() => {
            pdfDownloading.value = false;
            addLog('PDF下载完成');
          }, 3000);
        };
        
        const handleToggleToc = () => {
          showToc.value = !showToc.value;
          addLog(`切换目录显示: ${showToc.value ? '显示' : '隐藏'}`);
        };
        
        // 控制方法
        const resetStates = () => {
          headerMode.value = 'normal';
          isAuthenticated.value = false;
          isShareView.value = false;
          currentView.value = 'home';
          showTestToast.value = true;
          showToc.value = true;
          hasVideo.value = true;
          pdfDownloading.value = false;
          addLog('重置所有状态');
        };
        
        const toggleAuth = () => {
          isAuthenticated.value = !isAuthenticated.value;
          addLog(`切换登录状态: ${isAuthenticated.value ? '已登录' : '未登录'}`);
        };
        
        const clearLogs = () => {
          eventLogs.value = [];
        };
        
        // 组件加载
        onMounted(async () => {
          try {
            const app = getCurrentInstance().appContext.app;
            
            await ComponentLoader.registerComponents(app, [
              ['app-header', '/components/common/AppHeader', 'AppHeader']
            ]);
            
            console.log('AppHeader 组件加载成功');
            addLog('AppHeader 组件加载完成');
          } catch (error) {
            console.error('加载组件失败:', error);
            addLog(`组件加载失败: ${error.message}`);
          }
        });
        
        return {
          // 状态
          headerMode,
          isAuthenticated,
          isShareView,
          currentView,
          showTestToast,
          showToc,
          hasVideo,
          pdfDownloading,
          showDebugInfo,
          eventLogs,
          
          // 计算属性
          readingVideoUrl,
          
          // 事件处理
          handleHomeClick,
          handleViewChange,
          handleLoginShow,
          handleLogout,
          handleTestToast,
          handleBackToLibrary,
          handleOpenVideo,
          handleDownloadPDF,
          handleToggleToc,
          
          // 控制方法
          resetStates,
          toggleAuth,
          clearLogs
        };
      }
    });
    
    app.mount('#app');
  </script>
</body>
</html> 