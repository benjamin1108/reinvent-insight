<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CreateView 组件测试</title>
  
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  
  <!-- 基础样式 -->
  <link rel="stylesheet" href="/css/base/typography.css">
  <link rel="stylesheet" href="/css/base/effects.css">
  <link rel="stylesheet" href="/css/base/content.css">
  
  <!-- 测试页面样式 -->
  <style>
    body {
      background: #0f172a;
      color: #e5e7eb;
      padding: 2rem;
      margin: 0;
      min-height: 100vh;
    }
    
    .test-header {
      text-align: center;
      margin-bottom: 3rem;
    }
    
    .test-header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: #22d3ee;
    }
    
    .test-header p {
      color: #9ca3af;
    }
    
    .test-section {
      margin-bottom: 3rem;
      background: rgba(17, 24, 39, 0.5);
      border: 1px solid #374151;
      border-radius: 12px;
      padding: 2rem;
    }
    
    .test-title {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      color: #22d3ee;
    }
    
    .test-controls {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }
    
    .test-button {
      padding: 0.5rem 1rem;
      background: #1f2937;
      border: 1px solid #374151;
      border-radius: 0.5rem;
      color: #e5e7eb;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .test-button:hover {
      background: #374151;
      border-color: #22d3ee;
    }
    
    .test-input {
      flex: 1;
      padding: 0.5rem 1rem;
      background: #1f2937;
      border: 1px solid #374151;
      border-radius: 0.5rem;
      color: #e5e7eb;
      min-width: 300px;
    }
    
    .component-container {
      background: #0f172a;
      border-radius: 8px;
      padding: 2rem;
      min-height: 200px;
    }
    
    .back-link {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 0.5rem 1rem;
      background: rgba(34, 211, 238, 0.1);
      border: 1px solid #22d3ee;
      border-radius: 0.5rem;
      color: #22d3ee;
      text-decoration: none;
      transition: all 0.2s;
    }
    
    .back-link:hover {
      background: rgba(34, 211, 238, 0.2);
    }
  </style>
</head>
<body>
  <a href="/test/index.html" class="back-link">← 返回测试目录</a>
  
  <div id="app">
    <div class="test-header">
      <h1>CreateView 组件测试</h1>
      <p>YouTube链接输入和分析界面</p>
    </div>
    
    <!-- 测试用例1：基本渲染 -->
    <div class="test-section">
      <h2 class="test-title">测试用例1：基本渲染</h2>
      <div class="component-container">
        <create-view
          :url="url"
          :loading="loading"
          :progress-percent="progressPercent"
          :logs="logs"
          :finalized-logs="finalizedLogs"
          :summary="summary"
          :title="title"
          :rendered="rendered"
          @update:url="updateUrl"
          @start-analysis="startAnalysis"
          @view-summary="viewSummary">
        </create-view>
      </div>
    </div>
    
    <!-- 测试用例2：模拟分析过程 -->
    <div class="test-section">
      <h2 class="test-title">测试用例2：模拟分析过程</h2>
      <div class="test-controls">
        <input 
          v-model="testUrl" 
          class="test-input"
          placeholder="输入YouTube URL测试"
        />
        <button @click="simulateAnalysis" class="test-button">
          模拟分析
        </button>
        <button @click="resetAnalysis" class="test-button">
          重置
        </button>
      </div>
      <div class="component-container">
        <create-view
          :url="testUrl"
          :loading="testLoading"
          :progress-percent="testProgress"
          :logs="testLogs"
          :finalized-logs="testFinalizedLogs"
          :summary="testSummary"
          :title="testTitle"
          :rendered="testRendered"
          @update:url="val => testUrl = val"
          @start-analysis="handleTestAnalysis"
          @view-summary="handleTestViewSummary">
        </create-view>
      </div>
    </div>
    
    <!-- 测试用例3：错误状态 -->
    <div class="test-section">
      <h2 class="test-title">测试用例3：错误状态</h2>
      <div class="test-controls">
        <button @click="showInvalidUrl" class="test-button">
          显示无效URL
        </button>
        <button @click="showEmptyUrl" class="test-button">
          显示空URL
        </button>
      </div>
      <div class="component-container">
        <create-view
          :url="errorUrl"
          :loading="false"
          :progress-percent="0"
          :logs="[]"
          :finalized-logs="[]"
          @update:url="val => errorUrl = val">
        </create-view>
      </div>
    </div>
  </div>
  
  <!-- 组件加载器 -->
  <script src="/js/core/component-loader.js"></script>
  
  <script>
    const { createApp, ref } = Vue;
    
    const app = createApp({
      setup() {
        // 基本测试数据
        const url = ref('https://www.youtube.com/watch?v=abc123');
        const loading = ref(false);
        const progressPercent = ref(0);
        const logs = ref([]);
        const finalizedLogs = ref([]);
        const summary = ref('');
        const title = ref('');
        const rendered = ref('');
        
        // 模拟分析测试数据
        const testUrl = ref('');
        const testLoading = ref(false);
        const testProgress = ref(0);
        const testLogs = ref([]);
        const testFinalizedLogs = ref([]);
        const testSummary = ref('');
        const testTitle = ref('');
        const testRendered = ref('');
        
        // 错误测试数据
        const errorUrl = ref('');
        
        // 方法
        const updateUrl = (val) => {
          url.value = val;
        };
        
        const startAnalysis = (url) => {
          console.log('开始分析:', url);
          alert(`开始分析: ${url}`);
        };
        
        const viewSummary = (data) => {
          console.log('查看摘要:', data);
          alert(`查看摘要: ${data.title}`);
        };
        
        // 模拟分析过程
        const simulateAnalysis = () => {
          if (!testUrl.value) {
            alert('请输入YouTube URL');
            return;
          }
          
          testLoading.value = true;
          testProgress.value = 0;
          testLogs.value = [];
          
          const logs = [
            '开始分析视频...',
            '获取视频信息...',
            '下载字幕...',
            '分析内容...',
            '生成摘要...'
          ];
          
          let index = 0;
          const interval = setInterval(() => {
            if (index < logs.length) {
              testLogs.value.push(logs[index]);
              testProgress.value = ((index + 1) / logs.length) * 100;
              index++;
            } else {
              clearInterval(interval);
              testLoading.value = false;
              testTitle.value = 'AWS re:Invent 2023 - Keynote';
              testSummary.value = '这是一个模拟的视频摘要内容...';
              testRendered.value = '<h1>模拟分析结果</h1><p>这是渲染后的内容。</p>';
              testFinalizedLogs.value = [...testLogs.value];
            }
          }, 1000);
        };
        
        const resetAnalysis = () => {
          testUrl.value = '';
          testLoading.value = false;
          testProgress.value = 0;
          testLogs.value = [];
          testFinalizedLogs.value = [];
          testSummary.value = '';
          testTitle.value = '';
          testRendered.value = '';
        };
        
        const handleTestAnalysis = (url) => {
          console.log('测试分析:', url);
          simulateAnalysis();
        };
        
        const handleTestViewSummary = (data) => {
          console.log('测试查看摘要:', data);
          alert(`标题: ${data.title}\n\n摘要: ${data.summary}`);
        };
        
        // 错误测试
        const showInvalidUrl = () => {
          errorUrl.value = 'not-a-youtube-url';
        };
        
        const showEmptyUrl = () => {
          errorUrl.value = '';
        };
        
        return {
          // 基本测试
          url,
          loading,
          progressPercent,
          logs,
          finalizedLogs,
          summary,
          title,
          rendered,
          updateUrl,
          startAnalysis,
          viewSummary,
          
          // 模拟分析
          testUrl,
          testLoading,
          testProgress,
          testLogs,
          testFinalizedLogs,
          testSummary,
          testTitle,
          testRendered,
          simulateAnalysis,
          resetAnalysis,
          handleTestAnalysis,
          handleTestViewSummary,
          
          // 错误测试
          errorUrl,
          showInvalidUrl,
          showEmptyUrl
        };
      }
    });
    
    // 注册组件
    const components = [
      ['create-view', '/components/views/CreateView', 'CreateView'],
      ['tech-button', '/components/shared/TechButton', 'TechButton'],
      ['progress-bar', '/components/shared/ProgressBar', 'ProgressBar']
    ];
    
    Promise.all(components.map(async ([name, path, fileName]) => {
      try {
        await ComponentLoader.registerComponents(app, [[name, path, fileName]]);
        console.log(`Component ${name} loaded successfully`);
      } catch (error) {
        console.error(`Failed to load component ${name}:`, error);
      }
    })).then(() => {
      app.mount('#app');
      console.log('App mounted successfully');
    });
  </script>
</body>
</html> 