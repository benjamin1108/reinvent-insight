<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VideoPlayer 组件测试</title>
  <script src="/js/vendor/vue.global.prod.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background-color: #0a0e27;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .header {
      margin-bottom: 3rem;
    }
    
    .title {
      font-size: 2rem;
      font-weight: bold;
      background: linear-gradient(to right, #22d3ee, #3b82f6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 0.5rem;
    }
    
    .subtitle {
      color: #9ca3af;
    }
    
    .test-section {
      background: rgba(17, 24, 39, 0.8);
      border: 1px solid #374151;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
    }
    
    .section-title {
      color: #06b6d4;
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1.5rem;
    }
    
    .control-group {
      margin-bottom: 1.5rem;
    }
    
    .control-label {
      display: block;
      color: #d1d5db;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }
    
    .control-input {
      width: 100%;
      max-width: 400px;
      padding: 0.5rem;
      background: rgba(17, 24, 39, 0.8);
      border: 1px solid #4b5563;
      border-radius: 4px;
      color: white;
      font-size: 0.875rem;
    }
    
    .test-button {
      padding: 0.75rem 1.5rem;
      background: linear-gradient(to right, #06b6d4, #3b82f6);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.875rem;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.2s;
      margin-right: 1rem;
      margin-bottom: 1rem;
    }
    
    .test-button:hover {
      transform: scale(1.05);
      opacity: 0.9;
    }
    
    .test-button:active {
      transform: scale(0.98);
    }
    
    .video-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .video-item {
      background: rgba(31, 41, 55, 0.5);
      border: 1px solid #4b5563;
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .video-item:hover {
      background: rgba(31, 41, 55, 0.8);
      border-color: #06b6d4;
      transform: translateY(-2px);
    }
    
    .video-title {
      font-weight: 500;
      margin-bottom: 0.25rem;
    }
    
    .video-id {
      color: #9ca3af;
      font-size: 0.75rem;
    }
    
    .status-panel {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #1f2937;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
    }
    
    .status-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      color: #d1d5db;
      font-size: 0.875rem;
    }
    
    .status-item:last-child {
      margin-bottom: 0;
    }
    
    .status-label {
      color: #9ca3af;
    }
    
    .status-value {
      color: #60a5fa;
      font-weight: 500;
    }
    
    .checkbox-label {
      display: flex;
      align-items: center;
      color: #d1d5db;
      font-size: 0.875rem;
      cursor: pointer;
    }
    
    .checkbox-label input {
      margin-right: 0.5rem;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="container">
      <!-- 页面标题 -->
      <div class="header">
        <h1 class="title">VideoPlayer 组件测试</h1>
        <p class="subtitle">测试浮动视频播放器的各种功能</p>
      </div>

      <!-- 基础功能测试 -->
      <div class="test-section">
        <h2 class="section-title">基础功能测试</h2>
        
        <div class="control-group">
          <label class="control-label">自定义视频ID（YouTube）</label>
          <input v-model="customVideoId" 
                 class="control-input" 
                 placeholder="例如: dQw4w9WgXcQ">
        </div>
        
        <div class="control-group">
          <label class="control-label">视频标题</label>
          <input v-model="customTitle" 
                 class="control-input" 
                 placeholder="输入视频标题">
        </div>
        
        <div class="control-group">
          <label class="checkbox-label">
            <input type="checkbox" v-model="defaultMinimized">
            默认最小化
          </label>
        </div>
        
        <button @click="openCustomVideo" class="test-button">
          打开自定义视频
        </button>
        
        <button @click="closeVideo" class="test-button" :disabled="!showPlayer">
          关闭视频
        </button>
      </div>

      <!-- 预设视频列表 -->
      <div class="test-section">
        <h2 class="section-title">预设视频列表</h2>
        
        <div class="video-list">
          <div v-for="video in presetVideos" 
               :key="video.id"
               @click="openPresetVideo(video)"
               class="video-item">
            <div class="video-title">{{ video.title }}</div>
            <div class="video-id">ID: {{ video.id }}</div>
          </div>
        </div>
      </div>

      <!-- 状态监控 -->
      <div class="test-section">
        <h2 class="section-title">状态监控</h2>
        
        <div class="status-panel">
          <div class="status-item">
            <span class="status-label">播放器状态：</span>
            <span class="status-value">{{ showPlayer ? '显示' : '隐藏' }}</span>
          </div>
          <div class="status-item">
            <span class="status-label">最小化状态：</span>
            <span class="status-value">{{ playerMinimized ? '是' : '否' }}</span>
          </div>
          <div class="status-item">
            <span class="status-label">位置：</span>
            <span class="status-value">
              X: {{ playerPosition.x ?? 'auto' }}, 
              Y: {{ playerPosition.y ?? 'auto' }}
            </span>
          </div>
          <div class="status-item">
            <span class="status-label">大小：</span>
            <span class="status-value">
              {{ playerSize.width }} x {{ playerSize.height }}
            </span>
          </div>
          <div class="status-item">
            <span class="status-label">当前视频ID：</span>
            <span class="status-value">{{ currentVideoId || '无' }}</span>
          </div>
        </div>
        
        <button @click="resetPosition" class="test-button" style="margin-top: 1rem;">
          重置位置
        </button>
        
        <button @click="resetSize" class="test-button">
          重置大小
        </button>
      </div>
    </div>
    
    <!-- VideoPlayer 组件 -->
    <video-player
      :visible="showPlayer"
      :video-id="currentVideoId"
      :title="currentTitle"
      :initial-position="playerPosition"
      :initial-size="playerSize"
      :default-minimized="defaultMinimized"
      @update:visible="showPlayer = $event"
      @close="handleClose"
      @position-change="handlePositionChange"
      @size-change="handleSizeChange"
      @minimize-change="handleMinimizeChange"
    ></video-player>
  </div>

  <script type="module">
    import ComponentLoader from '/js/core/component-loader.js';
    
    const { createApp, ref, reactive, onMounted, getCurrentInstance } = Vue;
    
    createApp({
      setup() {
        // 状态
        const showPlayer = ref(false);
        const currentVideoId = ref('');
        const currentTitle = ref('');
        const customVideoId = ref('dQw4w9WgXcQ');
        const customTitle = ref('Rick Astley - Never Gonna Give You Up');
        const defaultMinimized = ref(false);
        const playerMinimized = ref(false);
        
        const playerPosition = reactive({
          x: null,
          y: null
        });
        
        const playerSize = reactive({
          width: 480,
          height: 320
        });
        
        // 预设视频
        const presetVideos = [
          {
            id: 'dQw4w9WgXcQ',
            title: 'Rick Astley - Never Gonna Give You Up'
          },
          {
            id: 'jNQXAC9IVRw',
            title: 'Me at the zoo (First YouTube video)'
          },
          {
            id: 'wZZ7oFKsKzY',
            title: 'Nyan Cat [original]'
          },
          {
            id: 'kJQP7kiw5Fk',
            title: 'Luis Fonsi - Despacito'
          },
          {
            id: '9bZkp7q19f0',
            title: 'PSY - GANGNAM STYLE'
          },
          {
            id: 'OPf0YbXqDm0',
            title: 'Mark Ronson - Uptown Funk'
          }
        ];
        
        // 方法
        const openCustomVideo = () => {
          if (!customVideoId.value) {
            alert('请输入视频ID');
            return;
          }
          
          currentVideoId.value = customVideoId.value;
          currentTitle.value = customTitle.value || '视频播放器';
          showPlayer.value = true;
        };
        
        const openPresetVideo = (video) => {
          currentVideoId.value = video.id;
          currentTitle.value = video.title;
          showPlayer.value = true;
        };
        
        const closeVideo = () => {
          showPlayer.value = false;
        };
        
        const handleClose = () => {
          console.log('视频播放器已关闭');
          currentVideoId.value = '';
          currentTitle.value = '';
        };
        
        const handlePositionChange = (position) => {
          playerPosition.x = position.x;
          playerPosition.y = position.y;
          console.log('位置变化:', position);
        };
        
        const handleSizeChange = (size) => {
          playerSize.width = size.width;
          playerSize.height = size.height;
          console.log('大小变化:', size);
        };
        
        const handleMinimizeChange = (minimized) => {
          playerMinimized.value = minimized;
          console.log('最小化状态:', minimized);
        };
        
        const resetPosition = () => {
          playerPosition.x = null;
          playerPosition.y = null;
        };
        
        const resetSize = () => {
          playerSize.width = 480;
          playerSize.height = 320;
        };
        
        // 组件加载
        onMounted(async () => {
          try {
            const app = getCurrentInstance().appContext.app;
            await ComponentLoader.registerComponents(app, [
              ['video-player', '/components/common/VideoPlayer', 'VideoPlayer']
            ]);
            console.log('VideoPlayer 组件加载成功');
          } catch (error) {
            console.error('加载组件失败:', error);
          }
        });
        
        return {
          // 状态
          showPlayer,
          currentVideoId,
          currentTitle,
          customVideoId,
          customTitle,
          defaultMinimized,
          playerMinimized,
          playerPosition,
          playerSize,
          presetVideos,
          
          // 方法
          openCustomVideo,
          openPresetVideo,
          closeVideo,
          handleClose,
          handlePositionChange,
          handleSizeChange,
          handleMinimizeChange,
          resetPosition,
          resetSize
        };
      }
    }).mount('#app');
  </script>
</body>
</html> 