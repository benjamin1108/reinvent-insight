# 自适应内容长度生成需求文档

## 项目简介

当前系统生成的文章长度固定在20k-30k字左右，没有根据YouTube视频的实际长度进行调整。需要实现一个自适应的内容长度生成机制，使生成的文章长度与视频内容的丰富程度和时长相匹配。

## 需求

### 需求1：视频长度分析与分类

**用户故事：** 作为系统管理员，我希望系统能够自动分析视频长度并进行分类，以便为不同长度的视频制定不同的内容生成策略。

#### 验收标准

1. WHEN 系统接收到YouTube视频链接 THEN 系统应该获取视频的准确时长信息
2. WHEN 视频时长获取成功 THEN 系统应该根据时长将视频分类为：
   - 短视频：< 20分钟
   - 中等视频：20-60分钟  
   - 长视频：60-120分钟
   - 超长视频：> 120分钟
3. WHEN 视频分类完成 THEN 系统应该记录分类结果用于后续处理

### 需求2：字幕密度分析

**用户故事：** 作为内容分析师，我希望系统能够分析字幕的信息密度，以便更准确地估算需要生成的内容长度。

#### 验收标准

1. WHEN 字幕下载完成 THEN 系统应该计算字幕的总字数
2. WHEN 字幕字数计算完成 THEN 系统应该计算信息密度指标：
   - 每分钟字数 = 总字数 / 视频时长(分钟)
   - 信息密度等级：低密度(<100字/分钟)、中密度(100-200字/分钟)、高密度(>200字/分钟)
3. WHEN 信息密度分析完成 THEN 系统应该将结果传递给内容生成模块

### 需求3：动态目标长度计算

**用户故事：** 作为AI内容生成器，我希望根据视频特征动态计算目标文章长度，以便生成长度适宜的内容。

#### 验收标准

1. WHEN 视频分类和信息密度分析完成 THEN 系统应该计算基础目标长度：
   - 短视频：原字幕长度的 60-80%
   - 中等视频：原字幕长度的 70-90%
   - 长视频：原字幕长度的 80-100%
   - 超长视频：原字幕长度的 90-110%
2. WHEN 基础目标长度计算完成 THEN 系统应该根据信息密度进行调整：
   - 低密度：目标长度 × 1.2
   - 中密度：目标长度 × 1.0
   - 高密度：目标长度 × 0.8
3. WHEN 最终目标长度确定 THEN 系统应该设置合理的长度范围（目标长度 ± 20%）

### 需求4：章节数量动态调整

**用户故事：** 作为内容结构设计师，我希望章节数量能够根据视频长度和内容复杂度动态调整，以便保持合理的内容结构。

#### 验收标准

1. WHEN 目标文章长度确定 THEN 系统应该计算合适的章节数量：
   - 短文章（<15k字）：8-12个章节
   - 中等文章（15k-25k字）：12-16个章节
   - 长文章（25k-35k字）：16-20个章节
   - 超长文章（>35k字）：20-25个章节
2. WHEN 章节数量确定 THEN 系统应该计算每章节的平均目标长度
3. WHEN 章节规划完成 THEN 系统应该将章节数量传递给大纲生成模块

### 需求5：提示词动态调整

**用户故事：** 作为AI提示词工程师，我希望提示词能够根据目标长度动态调整，以便生成符合长度要求的内容。

#### 验收标准

1. WHEN 目标长度和章节数量确定 THEN 系统应该调整大纲生成提示词：
   - 明确指定章节数量范围
   - 根据视频类型调整内容深度要求
2. WHEN 章节生成时 THEN 系统应该在提示词中包含：
   - 当前章节的目标字数范围
   - 内容详细程度的具体要求
   - 与其他章节的平衡要求
3. WHEN 结论生成时 THEN 系统应该根据总体长度调整洞见延伸的数量和深度

### 需求6：长度监控与调整

**用户故事：** 作为质量控制员，我希望系统能够在生成过程中监控内容长度，并在必要时进行调整。

#### 验收标准

1. WHEN 每个章节生成完成 THEN 系统应该统计当前总长度
2. WHEN 总长度偏离目标范围超过30% THEN 系统应该调整后续章节的生成策略
3. WHEN 所有章节生成完成 THEN 系统应该评估是否需要补充或精简内容
4. WHEN 最终组装完成 THEN 系统应该记录实际长度与目标长度的对比数据

### 需求7：长度配置管理

**用户故事：** 作为系统配置员，我希望能够配置长度生成的相关参数，以便根据需要调整生成策略。

#### 验收标准

1. WHEN 系统启动时 THEN 应该加载长度配置参数：
   - 各类视频的基础长度比例
   - 信息密度调整系数
   - 章节数量计算规则
2. WHEN 配置参数更新时 THEN 系统应该在下次任务中应用新配置
3. WHEN 需要调试时 THEN 系统应该提供长度计算的详细日志

## 技术约束

1. 长度计算应该在工作流开始阶段完成，为后续生成提供指导
2. 所有长度相关的计算应该有详细的日志记录
3. 系统应该能够处理异常情况（如无法获取视频时长）
4. 长度调整不应该影响内容质量，只调整详细程度

## 成功标准

1. 生成的文章长度与视频内容量相匹配
2. 短视频不会产生过长的冗余内容
3. 长视频能够得到充分详细的分析
4. 系统能够自动适应不同类型和长度的视频
5. 用户满意度提升，内容质量保持稳定