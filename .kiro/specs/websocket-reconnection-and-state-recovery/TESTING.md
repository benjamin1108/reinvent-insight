# 测试指南

## 功能测试

### 1. 测试自动重连功能

**步骤**:
1. 启动应用并登录
2. 发起一个分析任务（YouTube链接或PDF文件）
3. 等待任务开始处理（看到进度日志）
4. 在浏览器开发者工具中模拟网络断开：
   - 打开 DevTools (F12)
   - 切换到 Network 标签
   - 选择 "Offline" 模式
5. 观察UI变化

**预期结果**:
- 连接状态组件显示"正在重连 (1/5)"
- 日志中显示"连接断开，X秒后尝试重连"
- 背景色变为黄色（reconnecting状态）
- 自动开始重连倒计时

**恢复网络后**:
6. 在 DevTools 中切换回 "Online" 模式
7. 等待重连成功

**预期结果**:
- 连接状态组件消失（或显示"已连接"）
- 日志中显示"连接已恢复"
- Toast提示"连接已恢复"
- 任务继续正常进行

### 2. 测试重连次数限制

**步骤**:
1. 启动任务
2. 完全关闭后端服务器（模拟服务器宕机）
3. 观察重连尝试

**预期结果**:
- 连接状态显示重连次数递增：(1/5), (2/5), ..., (5/5)
- 每次重连延迟递增（3秒、6秒、12秒、24秒、30秒）
- 达到5次后停止自动重连
- 显示"连接失败，已达到最大重连次数"
- 显示"手动重连"按钮
- 背景色变为红色（disconnected状态）

**点击手动重连**:
4. 先启动后端服务器
5. 点击"手动重连"按钮

**预期结果**:
- 重连计数重置为0
- 成功重新连接
- 任务状态恢复

### 3. 测试页面刷新恢复

**步骤**:
1. 启动一个分析任务
2. 等待任务进行到一半（有一些日志）
3. 刷新浏览器页面（F5或Ctrl+R）

**预期结果**:
- 页面重新加载后自动恢复任务
- URL输入框显示之前的URL
- 日志显示之前的进度
- WebSocket自动重连
- 后端发送历史记录
- 任务继续进行

### 4. 测试UI反馈

**检查项**:
- [ ] 连接状态文本正确显示（已连接、正在连接、正在重连、连接已断开）
- [ ] 重连次数正确显示（X/5）
- [ ] 手动重连按钮只在达到最大次数后显示
- [ ] 样式正确切换：
  - connecting: 蓝色背景
  - reconnecting: 黄色背景
  - disconnected: 红色背景
- [ ] 脉冲动画在connecting和reconnecting状态下显示
- [ ] 按钮hover效果正常
- [ ] 组件在connected状态下隐藏

### 5. 测试边缘情况

#### 5.1 任务完成时断开连接
**步骤**:
1. 启动任务
2. 等待任务即将完成
3. 在任务完成前断开网络

**预期结果**:
- 任务完成后不应尝试重连
- connectionState变为'disconnected'
- 不显示重连提示

#### 5.2 用户主动停止任务
**步骤**:
1. 启动任务
2. 导航到其他页面（点击"笔记库"）

**预期结果**:
- WebSocket正常关闭
- 不触发重连逻辑
- 清理reconnectTimer

#### 5.3 快速多次断开重连
**步骤**:
1. 启动任务
2. 快速切换网络状态（Offline -> Online -> Offline -> Online）

**预期结果**:
- 系统能正确处理快速切换
- 不会创建多个重连定时器
- 状态保持一致

#### 5.4 长时间运行任务
**步骤**:
1. 启动一个长时间任务（大文件PDF）
2. 让任务运行超过10分钟
3. 期间模拟1-2次网络中断

**预期结果**:
- 任务能够稳定运行
- 重连后状态正确恢复
- 没有内存泄漏
- 日志正常累积

## 浏览器兼容性测试

测试以下浏览器：
- [ ] Chrome/Edge (最新版本)
- [ ] Firefox (最新版本)
- [ ] Safari (如果在Mac上)

## 性能测试

- [ ] 检查浏览器控制台无错误
- [ ] 检查内存使用正常（无泄漏）
- [ ] 重连逻辑不影响UI响应性

## 已知限制

1. 重连只在任务进行中（loading=true）时触发
2. 最多自动重连5次
3. 页面刷新后依赖localStorage恢复任务
4. 如果localStorage被清除，无法恢复任务
